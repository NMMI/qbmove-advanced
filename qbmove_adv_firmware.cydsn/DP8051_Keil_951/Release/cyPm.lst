C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE CYPM
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\cyPm.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.3\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\Generated_Source\PSoC3\cyPm.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) W
                    -L(2) PR(.\DP8051_Keil_951\Release/cyPm.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\cyPm.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          /*******************************************************************************
   2          * File Name: cyPm.c
   3          * Version 5.0
   4          *
   5          * Description:
   6          *  Provides an API for the power management.
   7          *
   8          * Note:
   9          *  Documentation of the API's in this file is located in the
  10          *  System Reference Guide provided with PSoC Creator.
  11          *
  12          ********************************************************************************
  13          * Copyright 2008-2015, Cypress Semiconductor Corporation.  All rights reserved.
  14          * You may use this file only in accordance with the license, terms, conditions,
  15          * disclaimers, and limitations in the end user license agreement accompanying
  16          * the software package with which this file was provided.
  17          *******************************************************************************/
  18          
  19          #include "cyPm.h"
  20          
  21          #ifdef CY_USE_CALLBACKS
                  #include "CyAPICallbacks.h"
              #endif  /* CY_USE_CALLBACKS */
  24          
  25          
  26          /*******************************************************************
  27          * Place your includes, defines, and code here. Do not use the merge
  28          * region below unless any component datasheet suggests doing so.
  29          *******************************************************************/
  30          /* `#START CY_PM_HEADER_INCLUDE` */
  31          
  32          /* `#END` */
  33          
  34          
  35          static CY_PM_BACKUP_STRUCT          cyPmBackup;
  36          static CY_PM_CLOCK_BACKUP_STRUCT    cyPmClockBackup;
  37          
  38          /* Convertion table between register's values and frequency in MHz  */
  39          static const uint8 CYCODE cyPmImoFreqReg2Mhz[7u] = {12u, 6u, 24u, 3u, 48u, 62u, 74u};
  40          
  41          /* Function Prototypes */
  42          static void CyPmHibSaveSet(void);
  43          static void CyPmHibRestore(void) ;
  44          
  45          static void CyPmHibSlpSaveSet(void) ;
  46          static void CyPmHibSlpRestore(void) ;
  47          
  48          static void CyPmHviLviSaveDisable(void) ;
  49          static void CyPmHviLviRestore(void) ;
  50          
  51          
  52          /*******************************************************************************
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 2   

  53          * Function Name: CyPmSaveClocks
  54          ********************************************************************************
  55          *
  56          * Summary:
  57          *  This function is called in preparation for entering sleep or hibernate low
  58          *  power modes. Saves all the states of the clocking system that do not persist
  59          *  during sleep/hibernate or that need to be altered in preparation for
  60          *  sleep/hibernate. Shutdowns all the digital and analog clock dividers for the
  61          *  active power mode configuration.
  62          *
  63          *  Switches the master clock over to the IMO and shuts down the PLL and MHz
  64          *  Crystal. The IMO frequency is set to either 12 MHz or 48 MHz to match the
  65          *  Design-Wide Resources System Editor "Enable Fast IMO During Startup" setting.
  66          *  The ILO and 32 KHz oscillators are not impacted. The current Flash wait state
  67          *  setting is saved and the Flash wait state setting is set for the current IMO
  68          *  speed.
  69          *
  70          *  Note If the Master Clock source is routed through the DSI inputs, then it
  71          *  must be set manually to another source before using the
  72          *  CyPmSaveClocks()/CyPmRestoreClocks() functions.
  73          *
  74          * Parameters:
  75          *  None
  76          *
  77          * Return:
  78          *  None
  79          *
  80          * Side Effects:
  81          *  All peripheral clocks are going to be off after this API method call.
  82          *
  83          *******************************************************************************/
  84          void CyPmSaveClocks(void) 
  85          {
  86   1          /* Digital and analog clocks - save enable state and disable them all */
  87   1          cyPmClockBackup.enClkA = CY_PM_ACT_CFG1_REG & CY_PM_ACT_EN_CLK_A_MASK;
  88   1          cyPmClockBackup.enClkD = CY_PM_ACT_CFG2_REG;
  89   1          CY_PM_ACT_CFG1_REG &= ((uint8)(~CY_PM_ACT_EN_CLK_A_MASK));
  90   1          CY_PM_ACT_CFG2_REG &= ((uint8)(~CY_PM_ACT_EN_CLK_D_MASK));
  91   1      
  92   1          /* Save current flash wait cycles and set the maximum value */
  93   1          cyPmClockBackup.flashWaitCycles = CY_PM_CACHE_CR_CYCLES_MASK & CY_PM_CACHE_CR_REG;
  94   1          CyFlash_SetWaitCycles(CY_PM_MAX_FLASH_WAIT_CYCLES);
  95   1      
  96   1          /* IMO - save current IMO MHz OSC frequency and USB mode is on bit */
  97   1          cyPmClockBackup.imoFreq = CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK;
  98   1          cyPmClockBackup.imoUsbClk = CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_USB;
  99   1      
 100   1          /* IMO doubler - save enable state */
 101   1          if(0u != (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_F2XON))
 102   1          {
 103   2              /* IMO doubler enabled - save and disable */
 104   2              cyPmClockBackup.imo2x = CY_PM_ENABLED;
 105   2          }
 106   1          else
 107   1          {
 108   2              /* IMO doubler disabled */
 109   2              cyPmClockBackup.imo2x = CY_PM_DISABLED;
 110   2          }
 111   1      
 112   1          /* Master clock - save source */
 113   1          cyPmClockBackup.masterClkSrc = CY_PM_CLKDIST_MSTR1_REG & CY_PM_MASTER_CLK_SRC_MASK;
 114   1      
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 3   

 115   1          /* Switch Master clock's source from PLL's output to PLL's source */
 116   1          if(CY_MASTER_SOURCE_PLL == cyPmClockBackup.masterClkSrc)
 117   1          {
 118   2              switch (CY_PM_CLKDIST_CR_REG & CY_PM_CLKDIST_PLL_SRC_MASK)
 119   2              {
 120   3              case CY_PM_CLKDIST_PLL_SRC_IMO:
 121   3                  CyMasterClk_SetSource(CY_MASTER_SOURCE_IMO);
 122   3                  break;
 123   3      
 124   3              case CY_PM_CLKDIST_PLL_SRC_XTAL:
 125   3                  CyMasterClk_SetSource(CY_MASTER_SOURCE_XTAL);
 126   3                  break;
 127   3      
 128   3              case CY_PM_CLKDIST_PLL_SRC_DSI:
 129   3                  CyMasterClk_SetSource(CY_MASTER_SOURCE_DSI);
 130   3                  break;
 131   3      
 132   3              default:
 133   3                  CYASSERT(0u != 0u);
 134   3                  break;
 135   3              }
 136   2          }
 137   1      
 138   1          /* PLL - check enable state, disable if needed */
 139   1          if(0u != (CY_PM_FASTCLK_PLL_CFG0_REG & CY_PM_PLL_CFG0_ENABLE))
 140   1          {
 141   2              /* PLL is enabled - save state and disable */
 142   2              cyPmClockBackup.pllEnableState = CY_PM_ENABLED;
 143   2              CyPLL_OUT_Stop();
 144   2          }
 145   1          else
 146   1          {
 147   2              /* PLL is disabled - save state */
 148   2              cyPmClockBackup.pllEnableState = CY_PM_DISABLED;
 149   2          }
 150   1      
 151   1          /* IMO - set appropriate frequency for LPM */
 152   1          CyIMO_SetFreq(CY_PM_IMO_FREQ_LPM);
 153   1      
 154   1          /* IMO - save enable state and enable without wait to settle */
 155   1          if(0u != (CY_PM_ACT_CFG0_IMO & CY_PM_ACT_CFG0_REG))
 156   1          {
 157   2              /* IMO - save enabled state */
 158   2              cyPmClockBackup.imoEnable = CY_PM_ENABLED;
 159   2          }
 160   1          else
 161   1          {
 162   2              /* IMO - save disabled state */
 163   2              cyPmClockBackup.imoEnable = CY_PM_DISABLED;
 164   2      
 165   2              /* Enable the IMO. Use software delay instead of the FTW-based inside */
 166   2              CyIMO_Start(CY_PM_IMO_NO_WAIT_TO_SETTLE);
 167   2      
 168   2              /* Settling time of the IMO is of the order of less than 6us */
 169   2              CyDelayUs(6u);
 170   2          }
 171   1      
 172   1          /* IMO - save the current IMOCLK source and set to IMO if not yet */
 173   1          if(0u != (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_XCLKEN))
 174   1          {
 175   2              /* DSI or XTAL CLK */
 176   2              cyPmClockBackup.imoClkSrc =
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 4   

 177   2                  (0u == (CY_PM_CLKDIST_CR_REG & CY_PM_CLKDIST_IMO2X_SRC)) ? CY_IMO_SOURCE_DSI : CY_IMO_SOURCE_X
             -TAL;
 178   2      
 179   2              /* IMO -  set IMOCLK source to IMO */
 180   2              CyIMO_SetSource(CY_IMO_SOURCE_IMO);
 181   2          }
 182   1          else
 183   1          {
 184   2              /* IMO */
 185   2              cyPmClockBackup.imoClkSrc = CY_IMO_SOURCE_IMO;
 186   2          }
 187   1      
 188   1          /* Save clk_imo source */
 189   1          cyPmClockBackup.clkImoSrc = CY_PM_CLKDIST_CR_REG & CY_PM_CLKDIST_IMO_OUT_MASK;
 190   1      
 191   1          /* If IMOCLK2X or SPC OSC is source for clk_imo, set it to IMOCLK */
 192   1          if(CY_PM_CLKDIST_IMO_OUT_IMO != cyPmClockBackup.clkImoSrc)
 193   1          {
 194   2              /* Set IMOCLK to source for clk_imo */
 195   2              CY_PM_CLKDIST_CR_REG = (CY_PM_CLKDIST_CR_REG & ((uint8)(~CY_PM_CLKDIST_IMO_OUT_MASK))) |
 196   2                                      CY_PM_CLKDIST_IMO_OUT_IMO;
 197   2          }    /* Need to change nothing if IMOCLK is source clk_imo */
 198   1      
 199   1          /* IMO doubler - disable it (saved above) */
 200   1          if(0u != (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_F2XON))
 201   1          {
 202   2              CyIMO_DisableDoubler();
 203   2          }
 204   1      
 205   1          /* Master clock - save divider and set it to divide-by-one (if no yet) */
 206   1          cyPmClockBackup.clkSyncDiv = CY_PM_CLKDIST_MSTR0_REG;
 207   1          if(CY_PM_DIV_BY_ONE != cyPmClockBackup.clkSyncDiv)
 208   1          {
 209   2              CyMasterClk_SetDivider(CY_PM_DIV_BY_ONE);
 210   2          }    /* No change if master clock divider is 1 */
 211   1      
 212   1          /* Master clock source - set it to IMO if not yet. */
 213   1          if(CY_MASTER_SOURCE_IMO != cyPmClockBackup.masterClkSrc)
 214   1          {
 215   2              CyMasterClk_SetSource(CY_MASTER_SOURCE_IMO);
 216   2          }    /* No change if master clock source is IMO */
 217   1      
 218   1          /* Bus clock - save divider and set it, if needed, to divide-by-one */
 219   1          cyPmClockBackup.clkBusDiv = (uint16) ((uint16) CY_PM_CLK_BUS_MSB_DIV_REG << 8u);
 220   1          cyPmClockBackup.clkBusDiv |= CY_PM_CLK_BUS_LSB_DIV_REG;
 221   1          if(CY_PM_BUS_CLK_DIV_BY_ONE != cyPmClockBackup.clkBusDiv)
 222   1          {
 223   2              CyBusClk_SetDivider(CY_PM_BUS_CLK_DIV_BY_ONE);
 224   2          }    /* Do nothing if saved and actual values are equal */
 225   1      
 226   1          /* Set number of wait cycles for flash according to CPU frequency in MHz */
 227   1          CyFlash_SetWaitCycles((uint8)CY_PM_GET_CPU_FREQ_MHZ);
 228   1      
 229   1          /* MHz ECO - check enable state and disable if needed */
 230   1          if(0u != (CY_PM_FASTCLK_XMHZ_CSR_REG & CY_PM_XMHZ_CSR_ENABLE))
 231   1          {
 232   2              /* MHz ECO is enabled - save state and disable */
 233   2              cyPmClockBackup.xmhzEnableState = CY_PM_ENABLED;
 234   2              CyXTAL_Stop();
 235   2          }
 236   1          else
 237   1          {
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 5   

 238   2              /* MHz ECO is disabled - save state */
 239   2              cyPmClockBackup.xmhzEnableState = CY_PM_DISABLED;
 240   2          }
 241   1      
 242   1      
 243   1          /***************************************************************************
 244   1          * Save the enable state of delay between the system bus clock and each of the
 245   1          * 4 individual analog clocks. This bit non-retention and its value should
 246   1          * be restored on wakeup.
 247   1          ***************************************************************************/
 248   1          if(0u != (CY_PM_CLKDIST_DELAY_REG & CY_PM_CLKDIST_DELAY_EN))
 249   1          {
 250   2              cyPmClockBackup.clkDistDelay = CY_PM_ENABLED;
 251   2          }
 252   1          else
 253   1          {
 254   2              cyPmClockBackup.clkDistDelay = CY_PM_DISABLED;
 255   2          }
 256   1      }
 257          
 258          
 259          /*******************************************************************************
 260          * Function Name: CyPmRestoreClocks
 261          ********************************************************************************
 262          *
 263          * Summary:
 264          *  Restores any state that was preserved by the last call to CyPmSaveClocks().
 265          *  The Flash wait state setting is also restored.
 266          *
 267          *  Note If the Master Clock source is routed through the DSI inputs, then it
 268          *  must be set manually to another source before using the
 269          *  CyPmSaveClocks()/CyPmRestoreClocks() functions.
 270          *
 271          *  PSoC 3 and PSoC 5LP:
 272          *  The merge region could be used to process state when the megahertz crystal is
 273          *  not ready after a hold-off timeout.
 274          *
 275          *  PSoC 5:
 276          *  The 130 ms is given for the megahertz crystal to stabilize. Its readiness is
 277          *  not verified after a hold-off timeout.
 278          *
 279          * Parameters:
 280          *  None
 281          *
 282          * Return:
 283          *  None
 284          *
 285          *******************************************************************************/
 286          void CyPmRestoreClocks(void) 
 287          {
 288   1          cystatus status = CYRET_TIMEOUT;
 289   1          uint16 i;
 290   1          uint16 clkBusDivTmp;
 291   1      
 292   1      
 293   1          /* Convertion table between CyIMO_SetFreq() parameters and register's value */
 294   1          const uint8 CYCODE cyPmImoFreqMhz2Reg[7u] = {
 295   1              CY_IMO_FREQ_12MHZ, CY_IMO_FREQ_6MHZ,  CY_IMO_FREQ_24MHZ, CY_IMO_FREQ_3MHZ,
 296   1              CY_IMO_FREQ_48MHZ, 5u, 6u};
 297   1      
 298   1          /* Restore enable state of delay between system bus clock and ACLKs. */
 299   1          if(CY_PM_ENABLED == cyPmClockBackup.clkDistDelay)
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 6   

 300   1          {
 301   2              /* Delay for both bandgap and delay line to settle out */
 302   2              CyDelayCycles((uint32)(CY_PM_CLK_DELAY_BANDGAP_SETTLE_US + CY_PM_CLK_DELAY_BIAS_SETTLE_US) *
 303   2                              CY_PM_GET_CPU_FREQ_MHZ);
 304   2      
 305   2              CY_PM_CLKDIST_DELAY_REG |= CY_PM_CLKDIST_DELAY_EN;
 306   2          }
 307   1      
 308   1          /* MHz ECO restore state */
 309   1          if(CY_PM_ENABLED == cyPmClockBackup.xmhzEnableState)
 310   1          {
 311   2              /***********************************************************************
 312   2              * Enabling XMHZ XTAL. The actual CyXTAL_Start() with a non zero wait
 313   2              * period uses FTW for period measurement. This could cause a problem
 314   2              * if CTW/FTW is used as a wake up time in the low power modes APIs.
 315   2              * So, the XTAL wait procedure is implemented with a software delay.
 316   2              ***********************************************************************/
 317   2      
 318   2              /* Enable XMHZ XTAL with no wait */
 319   2              (void) CyXTAL_Start(CY_PM_XTAL_MHZ_NO_WAIT);
 320   2      
 321   2              /* Read XERR bit to clear it */
 322   2              (void) CY_PM_FASTCLK_XMHZ_CSR_REG;
 323   2      
 324   2              /* Wait */
 325   2              for(i = CY_PM_MHZ_XTAL_WAIT_NUM_OF_200_US; i > 0u; i--)
 326   2              {
 327   3                  /* Make a 200 microseconds delay */
 328   3                  CyDelayCycles((uint32)CY_PM_WAIT_200_US * CY_PM_GET_CPU_FREQ_MHZ);
 329   3      
 330   3                  /* High output indicates oscillator failure */
 331   3                  if(0u == (CY_PM_FASTCLK_XMHZ_CSR_REG & CY_PM_XMHZ_CSR_XERR))
 332   3                  {
 333   4                      status = CYRET_SUCCESS;
 334   4                      break;
 335   4                  }
 336   3              }
 337   2      
 338   2              if(CYRET_TIMEOUT == status)
 339   2              {
 340   3                  /*******************************************************************
 341   3                  * Process the situation when megahertz crystal is not ready.
 342   3                  * Time to stabilize the value is crystal specific.
 343   3                  *******************************************************************/
 344   3                 /* `#START_MHZ_ECO_TIMEOUT` */
 345   3      
 346   3                 /* `#END` */
 347   3      
 348   3              #ifdef CY_BOOT_CY_PM_RESTORE_CLOCKS_ECO_TIMEOUT_CALLBACK
                          CyBoot_CyPmRestoreClocks_EcoTimeout_Callback();
                      #endif /* CY_BOOT_CY_PM_RESTORE_CLOCKS_ECO_TIMEOUT_CALLBACK */
 351   3              }
 352   2          }   /* (CY_PM_ENABLED == cyPmClockBackup.xmhzEnableState) */
 353   1      
 354   1      
 355   1          /* Temporary set maximum flash wait cycles */
 356   1          CyFlash_SetWaitCycles(CY_PM_MAX_FLASH_WAIT_CYCLES);
 357   1      
 358   1          /* XTAL and DSI clocks are ready to be source for Master clock. */
 359   1          if((CY_PM_MASTER_CLK_SRC_XTAL == cyPmClockBackup.masterClkSrc) ||
 360   1             (CY_PM_MASTER_CLK_SRC_DSI  == cyPmClockBackup.masterClkSrc))
 361   1          {
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 7   

 362   2              /* Restore Master clock's divider */
 363   2              if(CY_PM_CLKDIST_MSTR0_REG != cyPmClockBackup.clkSyncDiv)
 364   2              {
 365   3                  /* Restore Master clock divider */
 366   3                  CyMasterClk_SetDivider(cyPmClockBackup.clkSyncDiv);
 367   3              }
 368   2      
 369   2              /* Restore Master clock source */
 370   2              CyMasterClk_SetSource(cyPmClockBackup.masterClkSrc);
 371   2          }
 372   1      
 373   1          /* IMO - restore IMO frequency */
 374   1          if((0u != (cyPmClockBackup.imoUsbClk & CY_PM_FASTCLK_IMO_CR_USB)) &&
 375   1              (CY_IMO_FREQ_24MHZ == cyPmImoFreqMhz2Reg[cyPmClockBackup.imoFreq]))
 376   1          {
 377   2              /* Restore IMO frequency (24 MHz) and trim it for USB */
 378   2              CyIMO_SetFreq(CY_IMO_FREQ_USB);
 379   2          }
 380   1          else
 381   1          {
 382   2              /* Restore IMO frequency */
 383   2              CyIMO_SetFreq(cyPmImoFreqMhz2Reg[cyPmClockBackup.imoFreq]);
 384   2      
 385   2              if(0u != (cyPmClockBackup.imoUsbClk & CY_PM_FASTCLK_IMO_CR_USB))
 386   2              {
 387   3                  CY_PM_FASTCLK_IMO_CR_REG |= CY_PM_FASTCLK_IMO_CR_USB;
 388   3              }
 389   2              else
 390   2              {
 391   3                  CY_PM_FASTCLK_IMO_CR_REG &= ((uint8)(~CY_PM_FASTCLK_IMO_CR_USB));
 392   3              }
 393   2          }
 394   1      
 395   1          /* IMO - restore enable state if needed */
 396   1          if((CY_PM_ENABLED == cyPmClockBackup.imoEnable) &&
 397   1             (0u == (CY_PM_ACT_CFG0_IMO & CY_PM_ACT_CFG0_REG)))
 398   1          {
 399   2              /* IMO - restore enabled state */
 400   2              CyIMO_Start(CY_PM_IMO_NO_WAIT_TO_SETTLE);
 401   2          }
 402   1      
 403   1          /* IMO - restore IMOCLK source */
 404   1          CyIMO_SetSource(cyPmClockBackup.imoClkSrc);
 405   1      
 406   1          /* Restore IMO doubler enable state (turned off by CyPmSaveClocks()) */
 407   1          if(CY_PM_ENABLED == cyPmClockBackup.imo2x)
 408   1          {
 409   2              CyIMO_EnableDoubler();
 410   2          }
 411   1      
 412   1          /* IMO - restore clk_imo source, if needed */
 413   1          if(cyPmClockBackup.clkImoSrc != (CY_PM_CLKDIST_CR_REG & CY_PM_CLKDIST_IMO_OUT_MASK))
 414   1          {
 415   2              CY_PM_CLKDIST_CR_REG = (CY_PM_CLKDIST_CR_REG & ((uint8)(~CY_PM_CLKDIST_IMO_OUT_MASK))) |
 416   2                                      cyPmClockBackup.clkImoSrc;
 417   2          }
 418   1      
 419   1      
 420   1          /* PLL restore state */
 421   1          if(CY_PM_ENABLED == cyPmClockBackup.pllEnableState)
 422   1          {
 423   2              /***********************************************************************
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 8   

 424   2              * Enable PLL. The actual CyPLL_OUT_Start() without wait period uses FTW
 425   2              * for period measurement. This could cause a problem if CTW/FTW is used
 426   2              * as a wakeup time in the low power modes APIs. To omit this issue PLL
 427   2              * wait procedure is implemented with a software delay.
 428   2              ***********************************************************************/
 429   2              status = CYRET_TIMEOUT;
 430   2      
 431   2              /* Enable PLL */
 432   2              (void) CyPLL_OUT_Start(CY_PM_PLL_OUT_NO_WAIT);
 433   2      
 434   2              /* Read to clear lock status after delay */
 435   2              CyDelayUs((uint32)80u);
 436   2              (void) CY_PM_FASTCLK_PLL_SR_REG;
 437   2      
 438   2              /* It should take 250 us lock: 251-80 = 171 */
 439   2              for(i = 171u; i > 0u; i--)
 440   2              {
 441   3                  CyDelayUs((uint32)1u);
 442   3      
 443   3                  /* Accept PLL is OK after two consecutive polls indicate PLL lock */
 444   3                  if((0u != (CY_PM_FASTCLK_PLL_SR_REG & CY_PM_FASTCLK_PLL_LOCKED)) &&
 445   3                     (0u != (CY_PM_FASTCLK_PLL_SR_REG & CY_PM_FASTCLK_PLL_LOCKED)))
 446   3                  {
 447   4                      status = CYRET_SUCCESS;
 448   4                      break;
 449   4                  }
 450   3              }
 451   2      
 452   2              if(CYRET_TIMEOUT == status)
 453   2              {
 454   3                  /*******************************************************************
 455   3                  * Process the situation when PLL is not ready.
 456   3                  *******************************************************************/
 457   3                 /* `#START_PLL_TIMEOUT` */
 458   3      
 459   3                 /* `#END` */
 460   3      
 461   3              #ifdef CY_BOOT_CY_PM_RESTORE_CLOCKS_PLL_TIMEOUT_CALLBACK
                          CyBoot_CyPmRestoreClocks_PllTimeout_Callback();
                      #endif /* CY_BOOT_CY_PM_RESTORE_CLOCKS_PLL_TIMEOUT_CALLBACK */
 464   3              }
 465   2          }   /* (CY_PM_ENABLED == cyPmClockBackup.pllEnableState) */
 466   1      
 467   1      
 468   1          /* PLL and IMO is ready to be source for Master clock */
 469   1          if((CY_PM_MASTER_CLK_SRC_IMO == cyPmClockBackup.masterClkSrc) ||
 470   1             (CY_PM_MASTER_CLK_SRC_PLL == cyPmClockBackup.masterClkSrc))
 471   1          {
 472   2              /* Restore Master clock divider */
 473   2              if(CY_PM_CLKDIST_MSTR0_REG != cyPmClockBackup.clkSyncDiv)
 474   2              {
 475   3                  CyMasterClk_SetDivider(cyPmClockBackup.clkSyncDiv);
 476   3              }
 477   2      
 478   2              /* Restore Master clock source */
 479   2              CyMasterClk_SetSource(cyPmClockBackup.masterClkSrc);
 480   2          }
 481   1      
 482   1          /* IMO - disable if it was originally disabled */
 483   1          if((CY_PM_DISABLED == cyPmClockBackup.imoEnable) &&
 484   1             (0u != (CY_PM_ACT_CFG0_IMO & CY_PM_ACT_CFG0_REG)))
 485   1          {
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 9   

 486   2              CyIMO_Stop();
 487   2          }
 488   1      
 489   1          /* Bus clock - restore divider, if needed */
 490   1          clkBusDivTmp = (uint16) ((uint16)CY_PM_CLK_BUS_MSB_DIV_REG << 8u);
 491   1          clkBusDivTmp |= CY_PM_CLK_BUS_LSB_DIV_REG;
 492   1          if(cyPmClockBackup.clkBusDiv != clkBusDivTmp)
 493   1          {
 494   2              CyBusClk_SetDivider(cyPmClockBackup.clkBusDiv);
 495   2          }
 496   1      
 497   1          /* Restore flash wait cycles */
 498   1          CY_PM_CACHE_CR_REG = ((CY_PM_CACHE_CR_REG & ((uint8)(~CY_PM_CACHE_CR_CYCLES_MASK))) |
 499   1                                 cyPmClockBackup.flashWaitCycles);
 500   1      
 501   1          /* Digital and analog clocks - restore state */
 502   1          CY_PM_ACT_CFG1_REG = cyPmClockBackup.enClkA;
 503   1          CY_PM_ACT_CFG2_REG = cyPmClockBackup.enClkD;
 504   1      }
 505          
 506          
 507          /*******************************************************************************
 508          * Function Name: CyPmAltAct
 509          ********************************************************************************
 510          *
 511          * Summary:
 512          *  Puts the part into the Alternate Active (Standby) state. The Alternate Active
 513          *  state can allow for any of the capabilities of the device to be active, but
 514          *  the operation of this function is dependent on the CPU being disabled during
 515          *  the Alternate Active state. The configuration code and the component APIs
 516          *  will configure the template for the Alternate Active state to be the same as
 517          *  the Active state with the exception that the CPU will be disabled during
 518          *  Alternate Active.
 519          *
 520          *  Note Before calling this function, you must manually configure the power mode
 521          *  of the source clocks for the timer that is used as the wakeup timer.
 522          *
 523          *  PSoC 3:
 524          *  Before switching to Alternate Active, if a wakeupTime other than NONE is
 525          *  specified, then the appropriate timer state is configured as specified with
 526          *  the interrupt for that timer disabled.  The wakeup source will be the
 527          *  combination of the values specified in the wakeupSource and any timer
 528          *  specified in the wakeupTime argument.  Once the wakeup condition is
 529          *  satisfied, then all saved state is restored and the function returns in the
 530          *  Active state.
 531          *
 532          *  Note that if the wakeupTime is made with a different value, the period before
 533          *  the wakeup occurs can be significantly shorter than the specified time.  If
 534          *  the next call is made with the same wakeupTime value, then the wakeup will
 535          *  occur the specified period after the previous wakeup occurred.
 536          *
 537          *  If a wakeupTime other than NONE is specified, then upon exit the state of the
 538          *  specified timer will be left as specified by wakeupTime with the timer
 539          *  enabled and the interrupt disabled.  If the CTW, FTW or One PPS is already
 540          *  configured for wakeup, for example with the SleepTimer or RTC components,
 541          *  then specify NONE for the wakeupTime and include the appropriate source for
 542          *  wakeupSource.
 543          *
 544          *  PSoC 5LP:
 545          *  This function is used to both enter the Alternate Active mode and halt the
 546          *  processor.  For PSoC 3 these two actions must be paired together.  With PSoC
 547          *  5LP the processor can be halted independently with the __WFI() function from
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 10  

 548          *  the CMSIS library that is included in Creator.  This function should be used
 549          *  instead when the action required is just to halt the processor until an
 550          *  enabled interrupt occurs.
 551          *
 552          *  The wakeupTime parameter is not used for this device. It must be set to zero
 553          *  (PM_ALT_ACT_TIME_NONE). The wake up time configuration can be done by a
 554          *  separate component: the CTW wakeup interval should be configured with the
 555          *  Sleep Timer component and one second interval should be configured with the
 556          *  RTC component.
 557          *
 558          *  The wakeup behavior depends on the wakeupSource parameter in the following
 559          *  manner: upon function execution the device will be switched from Active to
 560          *  Alternate Active mode and then the CPU will be halted. When an enabled wakeup
 561          *  event occurs the device will return to Active mode.  Similarly when an
 562          *  enabled interrupt occurs the CPU will be started. These two actions will
 563          *  occur together provided that the event that occurs is an enabled wakeup
 564          *  source and also generates an interrupt. If just the wakeup event occurs then
 565          *  the device will be in Active mode, but the CPU will remain halted waiting for
 566          *  an interrupt. If an interrupt occurs from something other than a wakeup
 567          *  source, then the CPU will restart with the device in Alternate Active mode
 568          *  until a wakeup event occurs.
 569          *
 570          *  For example, if CyPmAltAct(PM_ALT_ACT_TIME_NONE, PM_ALT_ACT_SRC_PICU) is
 571          *  called and PICU interrupt occurs, the CPU will be started and device will be
 572          *  switched into Active mode. And if CyPmAltAct(PM_ALT_ACT_TIME_NONE,
 573          *  PM_ALT_ACT_SRC_NONE) is called and PICU interrupt occurs, the CPU will be
 574          *  started while device remains in Alternate Active mode.
 575          *
 576          * Parameters:
 577          *  wakeupTime: Specifies a timer wakeup source and the frequency of that
 578          *              source. For PSoC 5LP this parameter is ignored.
 579          *
 580          *           Define                      Time
 581          *  PM_ALT_ACT_TIME_NONE             None
 582          *  PM_ALT_ACT_TIME_ONE_PPS          One PPS: 1 second
 583          *  PM_ALT_ACT_TIME_CTW_2MS          CTW: 2 ms
 584          *  PM_ALT_ACT_TIME_CTW_4MS          CTW: 4 ms
 585          *  PM_ALT_ACT_TIME_CTW_8MS          CTW: 8 ms
 586          *  PM_ALT_ACT_TIME_CTW_16MS         CTW: 16 ms
 587          *  PM_ALT_ACT_TIME_CTW_32MS         CTW: 32 ms
 588          *  PM_ALT_ACT_TIME_CTW_64MS         CTW: 64 ms
 589          *  PM_ALT_ACT_TIME_CTW_128MS        CTW: 128 ms
 590          *  PM_ALT_ACT_TIME_CTW_256MS        CTW: 256 ms
 591          *  PM_ALT_ACT_TIME_CTW_512MS        CTW: 512 ms
 592          *  PM_ALT_ACT_TIME_CTW_1024MS       CTW: 1024 ms
 593          *  PM_ALT_ACT_TIME_CTW_2048MS       CTW: 2048 ms
 594          *  PM_ALT_ACT_TIME_CTW_4096MS       CTW: 4096 ms
 595          *  PM_ALT_ACT_TIME_FTW(1-256)*       FTW: 10us to 2.56 ms
 596          *
 597          *  *Note:   PM_ALT_ACT_TIME_FTW() is a macro that takes an argument that
 598          *           specifies how many increments of 10 us to delay.
 599                      For PSoC 3 silicon the valid range of  values is 1 to 256.
 600          *
 601          *  wakeUpSource:    Specifies a bitwise mask of wakeup sources. In addition, if
 602          *                   a wakeupTime has been specified, the associated timer will
 603          *                   be included as a wakeup source.
 604          *
 605          *           Define                      Source
 606          *  PM_ALT_ACT_SRC_NONE              None
 607          *  PM_ALT_ACT_SRC_COMPARATOR0       Comparator 0
 608          *  PM_ALT_ACT_SRC_COMPARATOR1       Comparator 1
 609          *  PM_ALT_ACT_SRC_COMPARATOR2       Comparator 2
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 11  

 610          *  PM_ALT_ACT_SRC_COMPARATOR3       Comparator 3
 611          *  PM_ALT_ACT_SRC_INTERRUPT         Interrupt
 612          *  PM_ALT_ACT_SRC_PICU              PICU
 613          *  PM_ALT_ACT_SRC_I2C               I2C
 614          *  PM_ALT_ACT_SRC_BOOSTCONVERTER    Boost Converter
 615          *  PM_ALT_ACT_SRC_FTW               Fast Timewheel*
 616          *  PM_ALT_ACT_SRC_VD                High and Low Voltage Detection (HVI, LVI)*
 617          *  PM_ALT_ACT_SRC_CTW               Central Timewheel**
 618          *  PM_ALT_ACT_SRC_ONE_PPS           One PPS**
 619          *  PM_ALT_ACT_SRC_LCD               LCD
 620          *
 621          *  *Note : FTW and HVI/LVI wakeup signals are in the same mask bit.
 622          *  **Note: CTW and One PPS wakeup signals are in the same mask bit.
 623          *
 624          *  When specifying a Comparator as the wakeupSource, an instance specific define
 625          *  that will track with the specific comparator that the instance
 626          *  is placed into should be used. As an example, for a Comparator instance named
 627          *  MyComp the value to OR into the mask is: MyComp_ctComp__CMP_MASK.
 628          *
 629          *  When CTW, FTW or One PPS is used as a wakeup source, the CyPmReadStatus()
 630          *  function must be called upon wakeup with a corresponding parameter. Please
 631          *  refer to the CyPmReadStatus() API in the System Reference Guide for more
 632          *  information.
 633          *
 634          * Return:
 635          *  None
 636          *
 637          * Reentrant:
 638          *  No
 639          *
 640          * Side Effects:
 641          *  If a wakeupTime other than NONE is specified, then upon exit the state of the
 642          *  specified timer will be left as specified by wakeupTime with the timer
 643          *  enabled and the interrupt disabled.  Also, the ILO 1 KHz (if CTW timer is
 644          *  used as wakeup time) or ILO 100 KHz (if the FTW timer is used as wakeup time)
 645          *  will be left started.
 646          *
 647          *******************************************************************************/
 648          void CyPmAltAct(uint16 wakeupTime, uint16 wakeupSource) 
 649          {
 650   1          #if(CY_PSOC5)
              
                      /* Arguments expected to be 0 */
                      CYASSERT(PM_ALT_ACT_TIME_NONE == wakeupTime);
              
                      if(0u != wakeupTime)
                      {
                          /* To remove unreferenced local variable warning */
                      }
              
                  #endif /* (CY_PSOC5) */
 661   1      
 662   1      
 663   1          #if(CY_PSOC3)
 664   1      
 665   1              /* FTW - save current and set new configuration */
 666   1              if((wakeupTime >= PM_ALT_ACT_TIME_FTW(1u)) && (wakeupTime <= PM_ALT_ACT_TIME_FTW(256u)))
 667   1              {
 668   2                  CyPmFtwSetInterval(PM_ALT_ACT_FTW_INTERVAL(wakeupTime));
 669   2      
 670   2                  /* Include associated timer to wakeupSource */
 671   2                  wakeupSource |= PM_ALT_ACT_SRC_FTW;
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 12  

 672   2              }
 673   1      
 674   1              /* CTW - save current and set new configuration */
 675   1              if((wakeupTime >= PM_ALT_ACT_TIME_CTW_2MS) && (wakeupTime <= PM_ALT_ACT_TIME_CTW_4096MS))
 676   1              {
 677   2                  /* Save current CTW configuration and set new one */
 678   2                  CyPmCtwSetInterval((uint8)(wakeupTime - 1u));
 679   2      
 680   2                  /* Include associated timer to wakeupSource */
 681   2                  wakeupSource |= PM_ALT_ACT_SRC_CTW;
 682   2              }
 683   1      
 684   1              /* 1PPS - save current and set new configuration */
 685   1              if(PM_ALT_ACT_TIME_ONE_PPS == wakeupTime)
 686   1              {
 687   2                  /* Save current 1PPS configuration and set new one */
 688   2                  CyPmOppsSet();
 689   2      
 690   2                  /* Include associated timer to wakeupSource */
 691   2                  wakeupSource |= PM_ALT_ACT_SRC_ONE_PPS;
 692   2              }
 693   1      
 694   1          #endif /* (CY_PSOC3) */
 695   1      
 696   1      
 697   1          /* Save and set new wake up configuration */
 698   1      
 699   1          /* Interrupt, PICU, I2C, Boost converter, CTW/1PPS */
 700   1          cyPmBackup.wakeupCfg0 = CY_PM_WAKEUP_CFG0_REG;
 701   1          CY_PM_WAKEUP_CFG0_REG = (uint8) (wakeupSource >> 4u);
 702   1      
 703   1          /* Comparators */
 704   1          cyPmBackup.wakeupCfg1 = CY_PM_WAKEUP_CFG1_REG;
 705   1          CY_PM_WAKEUP_CFG1_REG = (((uint8) wakeupSource) & CY_PM_WAKEUP_SRC_CMPS_MASK);
 706   1      
 707   1          /* LCD */
 708   1          cyPmBackup.wakeupCfg2 = CY_PM_WAKEUP_CFG2_REG;
 709   1          CY_PM_WAKEUP_CFG2_REG = ((uint8) ((wakeupSource >> 12u) & 0x01u));
 710   1      
 711   1      
 712   1          /* Switch to the Alternate Active mode */
 713   1          CY_PM_MODE_CSR_REG = ((CY_PM_MODE_CSR_REG & ((uint8)(~CY_PM_MODE_CSR_MASK))) | CY_PM_MODE_CSR_ALT_ACT)
             -;
 714   1      
 715   1          /* Recommended readback. */
 716   1          (void) CY_PM_MODE_CSR_REG;
 717   1      
 718   1          /* Two recommended NOPs to get into the mode. */
 719   1          CY_NOP;
 720   1          CY_NOP;
 721   1      
 722   1          /* Execute WFI instruction (for ARM-based devices only) */
 723   1          CY_PM_WFI;
 724   1      
 725   1          /* Point of return from Alternate Active Mode */
 726   1      
 727   1          /* Restore wake up configuration */
 728   1          CY_PM_WAKEUP_CFG0_REG = cyPmBackup.wakeupCfg0;
 729   1          CY_PM_WAKEUP_CFG1_REG = cyPmBackup.wakeupCfg1;
 730   1          CY_PM_WAKEUP_CFG2_REG = cyPmBackup.wakeupCfg2;
 731   1      }
 732          
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 13  

 733          
 734          /*******************************************************************************
 735          * Function Name: CyPmSleep
 736          ********************************************************************************
 737          *
 738          * Summary:
 739          *  Puts the part into the Sleep state.
 740          *
 741          *  Note Before calling this function, you must manually configure the power
 742          *  mode of the source clocks for the timer that is used as the wakeup timer.
 743          *
 744          *  Note Before calling this function, you must prepare clock tree configuration
 745          *  for the low power mode by calling CyPmSaveClocks(). And restore clock
 746          *  configuration after CyPmSleep() execution by calling CyPmRestoreClocks(). See
 747          *  Power Management section, Clock Configuration subsection of the System
 748          *  Reference Guide for more information.
 749          *
 750          *  PSoC 3:
 751          *  Before switching to Sleep, if a wakeupTime other than NONE is specified,
 752          *  then the appropriate timer state is configured as specified with the
 753          *  interrupt for that timer disabled.  The wakeup source will be a combination
 754          *  of the values specified in the wakeupSource and any timer specified in the
 755          *  wakeupTime argument.  Once the wakeup condition is satisfied, then all saved
 756          *  state is restored and the function returns in the Active state.
 757          *
 758          *  Note that if the wakeupTime is made with a different value, the period before
 759          *  the wakeup occurs can be significantly shorter than the specified time.  If
 760          *  the next call is made with the same wakeupTime value, then the wakeup will
 761          *  occur the specified period after the previous wakeup occurred.
 762          *
 763          *  If a wakeupTime other than NONE is specified, then upon exit the state of the
 764          *  specified timer will be left as specified by wakeupTime with the timer
 765          *  enabled and the interrupt disabled.  If the CTW or One PPS is already
 766          *  configured for wakeup, for example with the SleepTimer or RTC components,
 767          *  then specify NONE for the wakeupTime and include the appropriate source for
 768          *  wakeupSource.
 769          *
 770          *  PSoC 5LP:
 771          *  The wakeupTime parameter is not used and the only NONE can be specified.
 772          *  The wakeup time must be configured with the component, SleepTimer for CTW
 773          *  intervals and RTC for 1PPS interval. The component must be configured to
 774          *  generate interrupt.
 775          *
 776          * Parameters:
 777          *  wakeupTime:      Specifies a timer wakeup source and the frequency of that
 778          *                   source. For PSoC 5LP, this parameter is ignored.
 779          *
 780          *           Define                      Time
 781          *  PM_SLEEP_TIME_NONE               None
 782          *  PM_SLEEP_TIME_ONE_PPS            One PPS: 1 second
 783          *  PM_SLEEP_TIME_CTW_2MS            CTW: 2 ms
 784          *  PM_SLEEP_TIME_CTW_4MS            CTW: 4 ms
 785          *  PM_SLEEP_TIME_CTW_8MS            CTW: 8 ms
 786          *  PM_SLEEP_TIME_CTW_16MS           CTW: 16 ms
 787          *  PM_SLEEP_TIME_CTW_32MS           CTW: 32 ms
 788          *  PM_SLEEP_TIME_CTW_64MS           CTW: 64 ms
 789          *  PM_SLEEP_TIME_CTW_128MS          CTW: 128 ms
 790          *  PM_SLEEP_TIME_CTW_256MS          CTW: 256 ms
 791          *  PM_SLEEP_TIME_CTW_512MS          CTW: 512 ms
 792          *  PM_SLEEP_TIME_CTW_1024MS         CTW: 1024 ms
 793          *  PM_SLEEP_TIME_CTW_2048MS         CTW: 2048 ms
 794          *  PM_SLEEP_TIME_CTW_4096MS         CTW: 4096 ms
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 14  

 795          *
 796          *  wakeUpSource:    Specifies a bitwise mask of wakeup sources. In addition, if
 797          *                   a wakeupTime has been specified the associated timer will be
 798          *                   included as a wakeup source.
 799          *
 800          *           Define                      Source
 801          *  PM_SLEEP_SRC_NONE                None
 802          *  PM_SLEEP_SRC_COMPARATOR0         Comparator 0
 803          *  PM_SLEEP_SRC_COMPARATOR1         Comparator 1
 804          *  PM_SLEEP_SRC_COMPARATOR2         Comparator 2
 805          *  PM_SLEEP_SRC_COMPARATOR3         Comparator 3
 806          *  PM_SLEEP_SRC_PICU                PICU
 807          *  PM_SLEEP_SRC_I2C                 I2C
 808          *  PM_SLEEP_SRC_BOOSTCONVERTER      Boost Converter
 809          *  PM_SLEEP_SRC_VD                  High and Low Voltage Detection (HVI, LVI)
 810          *  PM_SLEEP_SRC_CTW                 Central Timewheel*
 811          *  PM_SLEEP_SRC_ONE_PPS             One PPS*
 812          *  PM_SLEEP_SRC_LCD                 LCD
 813          *
 814          *  *Note:   CTW and One PPS wakeup signals are in the same mask bit.
 815          *
 816          *  When specifying a Comparator as the wakeupSource an instance specific define
 817          *  should be used that will track with the specific comparator that the instance
 818          *  is placed into. As an example for a Comparator instance named MyComp the
 819          *  value to OR into the mask is: MyComp_ctComp__CMP_MASK.
 820          *
 821          *  When CTW or One PPS is used as a wakeup source, the CyPmReadStatus()
 822          *  function must be called upon wakeup with corresponding parameter. Please
 823          *  refer to the CyPmReadStatus() API in the System Reference Guide for more
 824          *  information.
 825          *
 826          * Return:
 827          *  None
 828          *
 829          * Reentrant:
 830          *  No
 831          *
 832          * Side Effects and Restrictions:
 833          *  If a wakeupTime other than NONE is specified, then upon exit the state of the
 834          *  specified timer will be left as specified by wakeupTime with the timer
 835          *  enabled and the interrupt disabled. Also, the ILO 1 KHz (if CTW timer is
 836          *  used as wake up time) will be left started.
 837          *
 838          *  The 1 kHz ILO clock is expected to be enabled for PSoC 3 and PSoC 5LP to
 839          *  measure Hibernate/Sleep regulator settling time after a reset. The holdoff
 840          *  delay is measured using rising edges of the 1 kHz ILO.
 841          *
 842          *  For PSoC 3 silicon hardware buzz should be disabled before entering a sleep
 843          *  power mode. It is disabled by PSoC Creator during startup.
 844          *  If a Low Voltage Interrupt (LVI), High Voltage Interrupt (HVI) or Brown Out
 845          *  detect (power supply supervising capabilities) are required in a design
 846          *  during sleep, use the Central Time Wheel (CTW) to periodically wake the
 847          *  device, perform software buzz, and refresh the supervisory services. If LVI,
 848          *  HVI, or Brown Out is not required, then CTW is not required.
 849          *  Refer to the device errata for more information.
 850          *
 851          *******************************************************************************/
 852          void CyPmSleep(uint8 wakeupTime, uint16 wakeupSource) 
 853          {
 854   1          uint8 interruptState;
 855   1      
 856   1          /* Save current global interrupt enable and disable it */
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 15  

 857   1          interruptState = CyEnterCriticalSection();
 858   1      
 859   1      
 860   1          /***********************************************************************
 861   1          * The Hibernate/Sleep regulator has a settling time after a reset.
 862   1          * During this time, the system ignores requests to enter Sleep and
 863   1          * Hibernate modes. The holdoff delay is measured using rising edges of
 864   1          * the 1 kHz ILO.
 865   1          ***********************************************************************/
 866   1          if(0u == (CY_PM_MODE_CSR_REG & CY_PM_MODE_CSR_PWRUP_PULSE_Q))
 867   1          {
 868   2              /* Disable hold off - no action on restore */
 869   2              CY_PM_PWRSYS_SLP_TR_REG &= CY_PM_PWRSYS_SLP_TR_HIBSLP_HOLDOFF_MASK;
 870   2          }
 871   1          else
 872   1          {
 873   2              /* Abort, device is not ready for low power mode entry */
 874   2      
 875   2              /* Restore global interrupt enable state */
 876   2              CyExitCriticalSection(interruptState);
 877   2      
 878   2              return;
 879   2          }
 880   1      
 881   1      
 882   1          /***********************************************************************
 883   1          * PSoC3 < TO6:
 884   1          * - Hardware buzz must be disabled before the sleep mode entry.
 885   1          * - Voltage supervision (HVI/LVI) requires hardware buzz, so they must
 886   1          *   be also disabled.
 887   1          *
 888   1          * PSoC3 >= TO6:
 889   1          * - Voltage supervision (HVI/LVI) requires hardware buzz, so hardware
 890   1          *   buzz must be enabled before the sleep mode entry and restored on
 891   1          *   the wakeup.
 892   1          ***********************************************************************/
 893   1          #if(CY_PSOC3)
 894   1      
 895   1              /* Silicon Revision ID is below TO6 */
 896   1              if(CYDEV_CHIP_REV_ACTUAL < 5u)
 897   1              {
 898   2                  /* Hardware buzz expected to be disabled in Sleep mode */
 899   2                  CYASSERT(0u == (CY_PM_PWRSYS_WAKE_TR2_REG & CY_PM_PWRSYS_WAKE_TR2_EN_BUZZ));
 900   2              }
 901   1      
 902   1      
 903   1              if(0u != (CY_PM_RESET_CR1_REG & (CY_PM_RESET_CR1_HVIA_EN |
 904   1                  CY_PM_RESET_CR1_LVIA_EN | CY_PM_RESET_CR1_LVID_EN)))
 905   1              {
 906   2                  if(CYDEV_CHIP_REV_ACTUAL < 5u)
 907   2                  {
 908   3                      /* LVI/HVI requires hardware buzz to be enabled */
 909   3                      CYASSERT(0u != 0u);
 910   3                  }
 911   2                  else
 912   2                  {
 913   3                      if (0u == (CY_PM_PWRSYS_WAKE_TR2_REG & CY_PM_PWRSYS_WAKE_TR2_EN_BUZZ))
 914   3                      {
 915   4                          cyPmBackup.hardwareBuzz = CY_PM_DISABLED;
 916   4                          CY_PM_PWRSYS_WAKE_TR2_REG |= CY_PM_PWRSYS_WAKE_TR2_EN_BUZZ;
 917   4                      }
 918   3                      else
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 16  

 919   3                      {
 920   4                          cyPmBackup.hardwareBuzz = CY_PM_ENABLED;
 921   4                      }
 922   3                  }
 923   2              }
 924   1      
 925   1          #endif /* (CY_PSOC3) */
 926   1      
 927   1      
 928   1          /*******************************************************************************
 929   1          * For ARM-based devices,interrupt is required for the CPU to wake up. The
 930   1          * Power Management implementation assumes that wakeup time is configured with a
 931   1          * separate component (component-based wakeup time configuration) for
 932   1          * interrupt to be issued on terminal count. For more information, refer to the
 933   1          * Wakeup Time Configuration section of System Reference Guide.
 934   1          *******************************************************************************/
 935   1          #if(CY_PSOC5)
              
                      /* Arguments expected to be 0 */
                      CYASSERT(PM_SLEEP_TIME_NONE == wakeupTime);
              
                      if(0u != wakeupTime)
                      {
                          /* To remove unreferenced local variable warning */
                      }
              
                  #endif /* (CY_PSOC5) */
 946   1      
 947   1      
 948   1          CyPmHibSlpSaveSet();
 949   1      
 950   1      
 951   1          #if(CY_PSOC3)
 952   1      
 953   1              /* CTW - save current and set new configuration */
 954   1              if((wakeupTime >= PM_SLEEP_TIME_CTW_2MS) && (wakeupTime <= PM_SLEEP_TIME_CTW_4096MS))
 955   1              {
 956   2                  /* Save current and set new configuration of CTW */
 957   2                  CyPmCtwSetInterval((uint8)(wakeupTime - 1u));
 958   2      
 959   2                  /* Include associated timer to wakeupSource */
 960   2                  wakeupSource |= PM_SLEEP_SRC_CTW;
 961   2              }
 962   1      
 963   1              /* 1PPS - save current and set new configuration */
 964   1              if(PM_SLEEP_TIME_ONE_PPS == wakeupTime)
 965   1              {
 966   2                  /* Save current and set new configuration of the 1PPS */
 967   2                  CyPmOppsSet();
 968   2      
 969   2                  /* Include associated timer to wakeupSource */
 970   2                  wakeupSource |= PM_SLEEP_SRC_ONE_PPS;
 971   2              }
 972   1      
 973   1          #endif /* (CY_PSOC3) */
 974   1      
 975   1      
 976   1          /* Save and set new wake up configuration */
 977   1      
 978   1          /* Interrupt, PICU, I2C, Boost converter, CTW/1PPS */
 979   1          cyPmBackup.wakeupCfg0 = CY_PM_WAKEUP_CFG0_REG;
 980   1          CY_PM_WAKEUP_CFG0_REG = (uint8) (wakeupSource >> 4u);
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 17  

 981   1      
 982   1          /* Comparators */
 983   1          cyPmBackup.wakeupCfg1 = CY_PM_WAKEUP_CFG1_REG;
 984   1          CY_PM_WAKEUP_CFG1_REG = (((uint8) wakeupSource) & CY_PM_WAKEUP_SRC_CMPS_MASK);
 985   1      
 986   1          /* LCD */
 987   1          cyPmBackup.wakeupCfg2 = CY_PM_WAKEUP_CFG2_REG;
 988   1          CY_PM_WAKEUP_CFG2_REG = ((uint8) ((wakeupSource >> 12u) & 0x01u));
 989   1      
 990   1      
 991   1          /*******************************************************************
 992   1          * Do not use the merge region below unless any component datasheet
 993   1          * suggests doing so.
 994   1          *******************************************************************/
 995   1          /* `#START CY_PM_JUST_BEFORE_SLEEP` */
 996   1      
 997   1          /* `#END` */
 998   1      
 999   1          #ifdef CY_BOOT_CY_PM_SLEEP_BEFORE_SLEEP_CALLBACK
                      CyBoot_CyPmSleep_BeforeSleep_Callback();
                  #endif /* CY_BOOT_CY_PM_SLEEP_BEFORE_SLEEP_CALLBACK */
1002   1      
1003   1          /* Last moment IMO frequency change */
1004   1          if(0u == (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK))
1005   1          {
1006   2              /* IMO frequency is 12 MHz */
1007   2              cyPmBackup.imoActFreq12Mhz = CY_PM_ENABLED;
1008   2          }
1009   1          else
1010   1          {
1011   2              /* IMO frequency is not 12 MHz */
1012   2              cyPmBackup.imoActFreq12Mhz = CY_PM_DISABLED;
1013   2      
1014   2              /* Save IMO frequency */
1015   2              cyPmBackup.imoActFreq = CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK;
1016   2      
1017   2              /* Set IMO frequency to 12 MHz */
1018   2              CY_PM_FASTCLK_IMO_CR_REG &= ((uint8) (~CY_PM_FASTCLK_IMO_CR_FREQ_MASK));
1019   2          }
1020   1      
1021   1          /* Switch to Sleep mode */
1022   1          CY_PM_MODE_CSR_REG = ((CY_PM_MODE_CSR_REG & ((uint8)(~CY_PM_MODE_CSR_MASK))) | CY_PM_MODE_CSR_SLEEP);
1023   1      
1024   1          /* Recommended readback. */
1025   1          (void) CY_PM_MODE_CSR_REG;
1026   1      
1027   1          /* Two recommended NOPs to get into mode. */
1028   1          CY_NOP;
1029   1          CY_NOP;
1030   1      
1031   1          /* Execute WFI instruction (for ARM-based devices only) */
1032   1          CY_PM_WFI;
1033   1      
1034   1          /* Point of return from Sleep Mode */
1035   1      
1036   1          /* Restore last moment IMO frequency change */
1037   1          if(CY_PM_ENABLED != cyPmBackup.imoActFreq12Mhz)
1038   1          {
1039   2              CY_PM_FASTCLK_IMO_CR_REG  = (CY_PM_FASTCLK_IMO_CR_REG & ((uint8)(~CY_PM_FASTCLK_IMO_CR_FREQ_MASK))
             -) |
1040   2                                          cyPmBackup.imoActFreq;
1041   2          }
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 18  

1042   1      
1043   1      
1044   1          /*******************************************************************
1045   1          * Do not use merge region below unless any component datasheet
1046   1          * suggest to do so.
1047   1          *******************************************************************/
1048   1          /* `#START CY_PM_JUST_AFTER_WAKEUP_FROM_SLEEP` */
1049   1      
1050   1          /* `#END` */
1051   1      
1052   1          #ifdef CY_BOOT_CY_PM_SLEEP_AFTER_SLEEP_CALLBACK
                      CyBoot_CyPmSleep_AfterSleep_Callback();
                  #endif /* CY_BOOT_CY_PM_SLEEP_AFTER_SLEEP_CALLBACK */
1055   1      
1056   1          /* Restore hardware configuration */
1057   1          CyPmHibSlpRestore();
1058   1      
1059   1      
1060   1          /* Disable hardware buzz, if it was previously enabled */
1061   1          #if(CY_PSOC3)
1062   1      
1063   1              if(0u != (CY_PM_RESET_CR1_REG & (CY_PM_RESET_CR1_HVIA_EN |
1064   1                  CY_PM_RESET_CR1_LVIA_EN | CY_PM_RESET_CR1_LVID_EN)))
1065   1              {
1066   2                  if(CYDEV_CHIP_REV_ACTUAL >= 5u)
1067   2                  {
1068   3                      if (CY_PM_DISABLED == cyPmBackup.hardwareBuzz)
1069   3                      {
1070   4                          CY_PM_PWRSYS_WAKE_TR2_REG &= (uint8)(~CY_PM_PWRSYS_WAKE_TR2_EN_BUZZ);
1071   4                      }
1072   3                  }
1073   2              }
1074   1      
1075   1          #endif /* (CY_PSOC3) */
1076   1      
1077   1      
1078   1          /* Restore current wake up configuration */
1079   1          CY_PM_WAKEUP_CFG0_REG = cyPmBackup.wakeupCfg0;
1080   1          CY_PM_WAKEUP_CFG1_REG = cyPmBackup.wakeupCfg1;
1081   1          CY_PM_WAKEUP_CFG2_REG = cyPmBackup.wakeupCfg2;
1082   1      
1083   1          /* Restore global interrupt enable state */
1084   1          CyExitCriticalSection(interruptState);
1085   1      }
1086          
1087          
1088          /*******************************************************************************
1089          * Function Name: CyPmHibernate
1090          ********************************************************************************
1091          *
1092          * Summary:
1093          *  Puts the part into the Hibernate state.
1094          *
1095          *  Before switching to Hibernate, the current status of the PICU wakeup source
1096          *  bit is saved and then set. This configures the device to wake up from the
1097          *  PICU. Make sure you have at least one pin configured to generate PICU
1098          *  interrupt. For pin Px.y, the register "PICU_INTTYPE_PICUx_INTTYPEy" controls
1099          *  the PICU behavior. In the TRM, this register is "PICU[0..15]_INTTYPE[0..7]."
1100          *  In the Pins component datasheet, this register is referred to as the IRQ
1101          *  option. Once the wakeup occurs, the PICU wakeup source bit is restored and
1102          *  the PSoC returns to the Active state.
1103          *
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 19  

1104          * Parameters:
1105          *  None
1106          *
1107          * Return:
1108          *  None
1109          *
1110          * Reentrant:
1111          *  No
1112          *
1113          * Side Effects:
1114          *  Applications must wait 20 us before re-entering hibernate or sleep after
1115          *  waking up from hibernate. The 20 us allows the sleep regulator time to
1116          *  stabilize before the next hibernate / sleep event occurs. The 20 us
1117          *  requirement begins when the device wakes up. There is no hardware check that
1118          *  this requirement is met. The specified delay should be done on ISR entry.
1119          *
1120          *  After the wakeup PICU interrupt occurs, the Pin_ClearInterrupt() (where Pin
1121          *  is instance name of the Pins component) function must be called to clear the
1122          *  latched pin events to allow the proper Hibernate mode entry and to enable
1123          *  detection of future events.
1124          *
1125          *  The 1 kHz ILO clock is expected to be enabled for PSoC 3 and PSoC 5LP to
1126          *  measure Hibernate/Sleep regulator settling time after a reset. The holdoff
1127          *  delay is measured using the rising edges of the 1 kHz ILO.
1128          *
1129          *******************************************************************************/
1130          void CyPmHibernate(void) 
1131          {
1132   1          CyPmHibernateEx(CY_PM_HIB_SRC_PICU);
1133   1      }
1134          
1135          
1136          /*******************************************************************************
1137          * Function Name: CyPmHibernateEx
1138          ********************************************************************************
1139          *
1140          * Summary:
1141          *  Puts the part into the Hibernate state.
1142          *
1143          *  The following wake up sources can be configured: PICU interrupt, Comparator0,
1144          *  Comparator1, Comparator2, and Comparator3 output.
1145          *
1146          *  Before switching to Hibernate, the current status of the PICU wakeup source
1147          *  bit is saved and then set.
1148          *
1149          *  If using PICU as the wake up source, make sure you have at least one pin
1150          *  configured to generate a PICU interrupt. For pin Px.y, the register
1151          *  "PICU_INTTYPE_PICUx_INTTYPEy" controls  the PICU behavior. In the TRM, this
1152          *  register is "PICU[0..15]_INTTYPE[0..7]." In the Pins component datasheet,
1153          *  this register is referred to as the IRQ option. Once the wakeup occurs, the
1154          *  PICU wakeup source bit is restored and the PSoC returns to the Active state.
1155          *
1156          *  If using a comparator as the wake up source, make sure you call this function
1157          *  with the 'wakeupSource' parameter set to the appropriate comparator. The part
1158          *  is configured for the requested wakeup source by setting the corresponding
1159          *  bits in PM_WAKEUP_CFG1 register.
1160          *
1161          *  Function call CyPmHibernateEx(CY_PM_HIB_SRC_PICU) will act in the same way as
1162          *  CyPmHibernate().
1163          *
1164          * Parameters:
1165          *  wakeupSource:
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 20  

1166          *           Parameter Value             Description
1167          *       CY_PM_HIB_SRC_PICU          PICU interrupt is set as the wake up source.
1168          *       CY_PM_HIB_SRC_COMPARATOR0   Comparator 0 is set as the wake up source.
1169          *       CY_PM_HIB_SRC_COMPARATOR1   Comparator 1 is set as the wake up source.
1170          *       CY_PM_HIB_SRC_COMPARATOR2   Comparator 2 is set as the wake up source.
1171          *       CY_PM_HIB_SRC_COMPARATOR3   Comparator 3 is set as the wake up source.
1172          *
1173          * Return:
1174          *  None
1175          *
1176          * Reentrant:
1177          *  No
1178          *
1179          * Side Effects:
1180          *  Applications must wait 20 us before re-entering hibernate or sleep after
1181          *  waking up from hibernate. The 20 us allows the sleep regulator time to
1182          *  stabilize before the next hibernate / sleep event occurs. The 20 us
1183          *  requirement begins when the device wakes up. There is no hardware check that
1184          *  this requirement is met. The specified delay should be done on ISR entry.
1185          *
1186          *  After the wakeup PICU interrupt occurs, the Pin_ClearInterrupt() (where Pin
1187          *  is instance name of the Pins component) function must be called to clear the
1188          *  latched pin events to allow the proper Hibernate mode entry and to enable
1189          *  detection of future events.
1190          *
1191          *  The 1 kHz ILO clock is expected to be enabled for PSoC 3 and PSoC 5LP to
1192          *  measure Hibernate/Sleep regulator settling time after a reset. The holdoff
1193          *  delay is measured using the rising edges of the 1 kHz ILO.
1194          *
1195          *******************************************************************************/
1196          void CyPmHibernateEx(uint16 wakeupSource) 
1197          {
1198   1          uint8 interruptState;
1199   1      
1200   1          /* Save current global interrupt enable and disable it */
1201   1          interruptState = CyEnterCriticalSection();
1202   1      
1203   1              /***********************************************************************
1204   1              * The Hibernate/Sleep regulator has a settling time after a reset.
1205   1              * During this time, the system ignores requests to enter the Sleep and
1206   1              * Hibernate modes. The holdoff delay is measured using the rising edges of
1207   1              * the 1 kHz ILO.
1208   1              ***********************************************************************/
1209   1              if(0u == (CY_PM_MODE_CSR_REG & CY_PM_MODE_CSR_PWRUP_PULSE_Q))
1210   1              {
1211   2                  /* Disable hold off - no action on restore */
1212   2                  CY_PM_PWRSYS_SLP_TR_REG &= CY_PM_PWRSYS_SLP_TR_HIBSLP_HOLDOFF_MASK;
1213   2              }
1214   1              else
1215   1              {
1216   2                  /* Abort, device is not ready for low power mode entry */
1217   2      
1218   2                  /* Restore global interrupt enable state */
1219   2                  CyExitCriticalSection(interruptState);
1220   2      
1221   2                  return;
1222   2              }
1223   1      
1224   1          CyPmHibSaveSet();
1225   1      
1226   1      
1227   1          /* Save and set new wake up configuration */
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 21  

1228   1      
1229   1          /* Save and enable only wakeup on PICU */
1230   1          cyPmBackup.wakeupCfg0 = CY_PM_WAKEUP_CFG0_REG;
1231   1          CY_PM_WAKEUP_CFG0_REG = ((uint8) (wakeupSource >> 4u) & CY_PM_WAKEUP_PICU);
1232   1      
1233   1          /* Comparators */
1234   1          cyPmBackup.wakeupCfg1 = CY_PM_WAKEUP_CFG1_REG;
1235   1          CY_PM_WAKEUP_CFG1_REG = (((uint8) wakeupSource) & CY_PM_WAKEUP_SRC_CMPS_MASK);
1236   1      
1237   1          cyPmBackup.wakeupCfg2 = CY_PM_WAKEUP_CFG2_REG;
1238   1          CY_PM_WAKEUP_CFG2_REG = 0x00u;
1239   1      
1240   1      
1241   1          /* Last moment IMO frequency change */
1242   1          if(0u == (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK))
1243   1          {
1244   2              /* IMO frequency is 12 MHz */
1245   2              cyPmBackup.imoActFreq12Mhz = CY_PM_ENABLED;
1246   2          }
1247   1          else
1248   1          {
1249   2              /* IMO frequency is not 12 MHz */
1250   2              cyPmBackup.imoActFreq12Mhz = CY_PM_DISABLED;
1251   2      
1252   2              /* Save IMO frequency */
1253   2              cyPmBackup.imoActFreq = CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK;
1254   2      
1255   2              /* Set IMO frequency to 12 MHz */
1256   2              CY_PM_FASTCLK_IMO_CR_REG &= ((uint8) (~CY_PM_FASTCLK_IMO_CR_FREQ_MASK));
1257   2          }
1258   1      
1259   1      
1260   1          /* Switch to Hibernate Mode */
1261   1          CY_PM_MODE_CSR_REG = (CY_PM_MODE_CSR_REG & ((uint8) (~CY_PM_MODE_CSR_MASK))) | CY_PM_MODE_CSR_HIBERNAT
             -E;
1262   1      
1263   1          /* Recommended readback. */
1264   1          (void) CY_PM_MODE_CSR_REG;
1265   1      
1266   1          /* Two recommended NOPs to get into mode. */
1267   1          CY_NOP;
1268   1          CY_NOP;
1269   1      
1270   1          /* Execute WFI instruction (for ARM-based devices only) */
1271   1          CY_PM_WFI;
1272   1      
1273   1      
1274   1          /* Point of return from Hibernate mode */
1275   1      
1276   1      
1277   1          /* Restore last moment IMO frequency change */
1278   1          if(CY_PM_ENABLED != cyPmBackup.imoActFreq12Mhz)
1279   1          {
1280   2              CY_PM_FASTCLK_IMO_CR_REG  = (CY_PM_FASTCLK_IMO_CR_REG & ((uint8)(~CY_PM_FASTCLK_IMO_CR_FREQ_MASK))
             -) |
1281   2                                          cyPmBackup.imoActFreq;
1282   2          }
1283   1      
1284   1      
1285   1          /* Restore device for proper Hibernate mode exit*/
1286   1          CyPmHibRestore();
1287   1      
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 22  

1288   1          /* Restore current wake up configuration */
1289   1          CY_PM_WAKEUP_CFG0_REG = cyPmBackup.wakeupCfg0;
1290   1          CY_PM_WAKEUP_CFG1_REG = cyPmBackup.wakeupCfg1;
1291   1          CY_PM_WAKEUP_CFG2_REG = cyPmBackup.wakeupCfg2;
1292   1      
1293   1          /* Restore global interrupt enable state */
1294   1          CyExitCriticalSection(interruptState);
1295   1      }
1296          
1297          
1298          /*******************************************************************************
1299          * Function Name: CyPmReadStatus
1300          ********************************************************************************
1301          *
1302          * Summary:
1303          *  Manages the Power Manager Interrupt Status Register.  This register has the
1304          *  interrupt status for the one pulse per second, central timewheel and fast
1305          *  timewheel timers.  This hardware register clears on read.  To allow for only
1306          *  clearing the bits of interest and preserving the other bits, this function
1307          *  uses a shadow register that retains the state.  This function reads the
1308          *  status register and ORs that value with the shadow register.  That is the
1309          *  value that is returned.  Then the bits in the mask that are set are cleared
1310          *  from this value and written back to the shadow register.
1311          *
1312          *  Note You must call this function within 1 ms (1 clock cycle of the ILO)
1313          *  after a CTW event has occurred.
1314          *
1315          * Parameters:
1316          *  mask: Bits in the shadow register to clear.
1317          *
1318          *       Define                      Source
1319          *  CY_PM_FTW_INT                Fast Timewheel
1320          *  CY_PM_CTW_INT                Central Timewheel
1321          *  CY_PM_ONEPPS_INT             One Pulse Per Second
1322          *
1323          * Return:
1324          *  Status.  Same bits values as the mask parameter.
1325          *
1326          *******************************************************************************/
1327          uint8 CyPmReadStatus(uint8 mask) 
1328          {
1329   1          static uint8 interruptStatus;
1330   1          uint8 interruptState;
1331   1          uint8 tmpStatus;
1332   1      
1333   1          /* Enter critical section */
1334   1          interruptState = CyEnterCriticalSection();
1335   1      
1336   1          /* Save value of register, copy it and clear desired bit */
1337   1          interruptStatus |= CY_PM_INT_SR_REG;
1338   1          tmpStatus = interruptStatus & (CY_PM_FTW_INT | CY_PM_CTW_INT | CY_PM_ONEPPS_INT);
1339   1          interruptStatus &= ((uint8)(~mask));
1340   1      
1341   1          /* Exit critical section */
1342   1          CyExitCriticalSection(interruptState);
1343   1      
1344   1          return(tmpStatus);
1345   1      }
1346          
1347          
1348          /*******************************************************************************
1349          * Function Name: CyPmHibSaveSet
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 23  

1350          ********************************************************************************
1351          *
1352          * Summary:
1353          *  Prepare device for proper Hibernate low power mode entry:
1354          *  - Disables I2C backup regulator
1355          *  - Saves ILO power down mode state and enable it
1356          *  - Saves state of 1 kHz and 100 kHz ILO and disable them
1357          *  - Disables sleep regulator and shorts vccd to vpwrsleep
1358          *  - Save LVI/HVI configuration and disable them - CyPmHviLviSaveDisable()
1359          *  - CyPmHibSlpSaveSet() function is called
1360          *
1361          * Parameters:
1362          *  None
1363          *
1364          * Return:
1365          *  None
1366          *
1367          * Reentrant:
1368          *  No
1369          *
1370          *******************************************************************************/
1371          static void CyPmHibSaveSet(void) 
1372          {
1373   1          /* I2C backup reg must be off when the sleep regulator is unavailable */
1374   1          if(0u != (CY_PM_PWRSYS_CR1_REG & CY_PM_PWRSYS_CR1_I2CREG_BACKUP))
1375   1          {
1376   2              /***********************************************************************
1377   2              * If the I2C backup regulator is enabled, all the fixed-function registers
1378   2              * store their values while the device is in the low power mode, otherwise their
1379   2              * configuration is lost. The I2C API makes a decision to restore or not
1380   2              * to restore I2C registers based on this. If this regulator will be
1381   2              * disabled and then enabled, I2C API will suppose that the I2C block
1382   2              * registers preserved their values, while this is not true. So, the
1383   2              * backup regulator is disabled. The I2C sleep APIs is responsible for
1384   2              * restoration.
1385   2              ***********************************************************************/
1386   2      
1387   2              /* Disable I2C backup register */
1388   2              CY_PM_PWRSYS_CR1_REG &= ((uint8)(~CY_PM_PWRSYS_CR1_I2CREG_BACKUP));
1389   2          }
1390   1      
1391   1      
1392   1          /* Save current ILO power mode and ensure low power mode */
1393   1          cyPmBackup.iloPowerMode = CyILO_SetPowerMode(CY_PM_POWERDOWN_MODE);
1394   1      
1395   1          /* Save current 1kHz ILO enable state. Disabled automatically. */
1396   1          cyPmBackup.ilo1kEnable = (0u == (CY_PM_SLOWCLK_ILO_CR0_REG & CY_PM_ILO_CR0_EN_1K)) ?
1397   1                                      CY_PM_DISABLED : CY_PM_ENABLED;
1398   1      
1399   1          /* Save current 100kHz ILO enable state. Disabled automatically. */
1400   1          cyPmBackup.ilo100kEnable = (0u == (CY_PM_SLOWCLK_ILO_CR0_REG & CY_PM_ILO_CR0_EN_100K)) ?
1401   1                                      CY_PM_DISABLED : CY_PM_ENABLED;
1402   1      
1403   1      
1404   1          /* Disable the sleep regulator and shorts vccd to vpwrsleep */
1405   1          if(0u == (CY_PM_PWRSYS_SLP_TR_REG & CY_PM_PWRSYS_SLP_TR_BYPASS))
1406   1          {
1407   2              /* Save current bypass state */
1408   2              cyPmBackup.slpTrBypass = CY_PM_DISABLED;
1409   2              CY_PM_PWRSYS_SLP_TR_REG |= CY_PM_PWRSYS_SLP_TR_BYPASS;
1410   2          }
1411   1          else
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 24  

1412   1          {
1413   2              cyPmBackup.slpTrBypass = CY_PM_ENABLED;
1414   2          }
1415   1      
1416   1          /* LPCOMPs are always enabled (even when BOTH ext_vccd=1 and ext_vcca=1)*/
1417   1      
1418   1      
1419   1          /***************************************************************************
1420   1          * LVI/HVI must be disabled in Hibernate
1421   1          ***************************************************************************/
1422   1      
1423   1          /* Save LVI/HVI configuration and disable them */
1424   1          CyPmHviLviSaveDisable();
1425   1      
1426   1      
1427   1          /* Make the same preparations for Hibernate and Sleep modes */
1428   1          CyPmHibSlpSaveSet();
1429   1      
1430   1      
1431   1          /***************************************************************************
1432   1          * Save and set the power mode wakeup trim registers
1433   1          ***************************************************************************/
1434   1          cyPmBackup.wakeupTrim0 = CY_PM_PWRSYS_WAKE_TR0_REG;
1435   1          cyPmBackup.wakeupTrim1 = CY_PM_PWRSYS_WAKE_TR1_REG;
1436   1      
1437   1          CY_PM_PWRSYS_WAKE_TR0_REG = CY_PM_PWRSYS_WAKE_TR0;
1438   1          CY_PM_PWRSYS_WAKE_TR1_REG = CY_PM_PWRSYS_WAKE_TR1;
1439   1      }
1440          
1441          
1442          /*******************************************************************************
1443          * Function Name: CyPmHibRestore
1444          ********************************************************************************
1445          *
1446          * Summary:
1447          *  Restores the device for the proper Hibernate mode exit:
1448          *  - Restores LVI/HVI configuration - calsl CyPmHviLviRestore()
1449          *  - CyPmHibSlpSaveRestore() function is called
1450          *  - Restores ILO power down mode state and enables it
1451          *  - Restores the state of 1 kHz and 100 kHz ILO and disables them
1452          *  - Restores the sleep regulator settings
1453          *
1454          * Parameters:
1455          *  None
1456          *
1457          * Return:
1458          *  None
1459          *
1460          *******************************************************************************/
1461          static void CyPmHibRestore(void) 
1462          {
1463   1          /* Restore LVI/HVI configuration */
1464   1          CyPmHviLviRestore();
1465   1      
1466   1          /* Restore the same configuration for Hibernate and Sleep modes */
1467   1          CyPmHibSlpRestore();
1468   1      
1469   1          /* Restore 1kHz ILO enable state */
1470   1          if(CY_PM_ENABLED == cyPmBackup.ilo1kEnable)
1471   1          {
1472   2              /* Enable 1kHz ILO */
1473   2              CyILO_Start1K();
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 25  

1474   2          }
1475   1      
1476   1          /* Restore 100kHz ILO enable state */
1477   1          if(CY_PM_ENABLED == cyPmBackup.ilo100kEnable)
1478   1          {
1479   2              /* Enable 100kHz ILO */
1480   2              CyILO_Start100K();
1481   2          }
1482   1      
1483   1          /* Restore ILO power mode */
1484   1          (void) CyILO_SetPowerMode(cyPmBackup.iloPowerMode);
1485   1      
1486   1      
1487   1          if(CY_PM_DISABLED == cyPmBackup.slpTrBypass)
1488   1          {
1489   2              /* Enable the sleep regulator */
1490   2              CY_PM_PWRSYS_SLP_TR_REG &= ((uint8)(~CY_PM_PWRSYS_SLP_TR_BYPASS));
1491   2          }
1492   1      
1493   1      
1494   1          /***************************************************************************
1495   1          * Restore the power mode wakeup trim registers
1496   1          ***************************************************************************/
1497   1          CY_PM_PWRSYS_WAKE_TR0_REG = cyPmBackup.wakeupTrim0;
1498   1          CY_PM_PWRSYS_WAKE_TR1_REG = cyPmBackup.wakeupTrim1;
1499   1      }
1500          
1501          
1502          /*******************************************************************************
1503          * Function Name: CyPmCtwSetInterval
1504          ********************************************************************************
1505          *
1506          * Summary:
1507          *  Performs the CTW configuration:
1508          *  - Disables the CTW interrupt
1509          *  - Enables 1 kHz ILO
1510          *  - Sets a new CTW interval
1511          *
1512          * Parameters:
1513          *  ctwInterval: the CTW interval to be set.
1514          *
1515          * Return:
1516          *  None
1517          *
1518          * Side Effects:
1519          *  Enables ILO 1 KHz clock and leaves it enabled.
1520          *
1521          *******************************************************************************/
1522          void CyPmCtwSetInterval(uint8 ctwInterval) 
1523          {
1524   1          /* Disable CTW interrupt enable */
1525   1          CY_PM_TW_CFG2_REG &= ((uint8)(~CY_PM_CTW_IE));
1526   1      
1527   1          /* Enable 1kHz ILO (required for CTW operation) */
1528   1          CyILO_Start1K();
1529   1      
1530   1          /* Interval could be set only while CTW is disabled */
1531   1          if(0u != (CY_PM_TW_CFG2_REG & CY_PM_CTW_EN))
1532   1          {
1533   2              /* Set CTW interval if needed */
1534   2              if(CY_PM_TW_CFG1_REG != ctwInterval)
1535   2              {
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 26  

1536   3                  /* Disable the CTW, set new CTW interval and enable it again */
1537   3                  CY_PM_TW_CFG2_REG &= ((uint8)(~CY_PM_CTW_EN));
1538   3                  CY_PM_TW_CFG1_REG = ctwInterval;
1539   3                  CY_PM_TW_CFG2_REG |= CY_PM_CTW_EN;
1540   3              }   /* Required interval is already set */
1541   2          }
1542   1          else
1543   1          {
1544   2              /* Set CTW interval if needed */
1545   2              if(CY_PM_TW_CFG1_REG != ctwInterval)
1546   2              {
1547   3                  /* Set new CTW interval. Could be changed if CTW is disabled */
1548   3                  CY_PM_TW_CFG1_REG = ctwInterval;
1549   3              }   /* Required interval is already set */
1550   2      
1551   2              /* Enable CTW */
1552   2              CY_PM_TW_CFG2_REG |= CY_PM_CTW_EN;
1553   2          }
1554   1      }
1555          
1556          
1557          /*******************************************************************************
1558          * Function Name: CyPmOppsSet
1559          ********************************************************************************
1560          *
1561          * Summary:
1562          *  Performs 1PPS configuration:
1563          *  - Starts 32 KHz XTAL
1564          *  - Disables 1PPS interrupts
1565          *  - Enables 1PPS
1566          *
1567          * Parameters:
1568          *  None
1569          *
1570          * Return:
1571          *  None
1572          *
1573          *******************************************************************************/
1574          void CyPmOppsSet(void) 
1575          {
1576   1          /* Enable 32kHz XTAL if needed */
1577   1          if(0u == (CY_PM_SLOWCLK_X32_CR_REG & CY_PM_X32_CR_X32EN))
1578   1          {
1579   2              /* Enable 32kHz XTAL */
1580   2              CyXTAL_32KHZ_Start();
1581   2          }
1582   1      
1583   1          /* Disable 1PPS interrupt enable */
1584   1          CY_PM_TW_CFG2_REG &= ((uint8)(~CY_PM_1PPS_IE));
1585   1      
1586   1          /* Enable 1PPS operation */
1587   1          CY_PM_TW_CFG2_REG |= CY_PM_1PPS_EN;
1588   1      }
1589          
1590          
1591          /*******************************************************************************
1592          * Function Name: CyPmFtwSetInterval
1593          ********************************************************************************
1594          *
1595          * Summary:
1596          *  Performs the FTW configuration:
1597          *  - Disables the FTW interrupt
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 27  

1598          *  - Enables 100 kHz ILO
1599          *  - Sets a new FTW interval.
1600          *
1601          * Parameters:
1602          *  ftwInterval - FTW counter interval.
1603          *
1604          * Return:
1605          *  None
1606          *
1607          * Side Effects:
1608          *  Enables the ILO 100 KHz clock and leaves it enabled.
1609          *
1610          *******************************************************************************/
1611          void CyPmFtwSetInterval(uint8 ftwInterval) 
1612          {
1613   1          /* Disable FTW interrupt enable */
1614   1          CY_PM_TW_CFG2_REG &= ((uint8)(~CY_PM_FTW_IE));
1615   1      
1616   1          /* Enable 100kHz ILO */
1617   1          CyILO_Start100K();
1618   1      
1619   1          /* Interval could be set only while FTW is disabled */
1620   1          if(0u != (CY_PM_TW_CFG2_REG & CY_PM_FTW_EN))
1621   1          {
1622   2              /* Disable FTW, set new FTW interval if needed and enable it again */
1623   2              if(CY_PM_TW_CFG0_REG != ftwInterval)
1624   2              {
1625   3                  /* Disable CTW, set new CTW interval and enable it again */
1626   3                  CY_PM_TW_CFG2_REG &= ((uint8)(~CY_PM_FTW_EN));
1627   3                  CY_PM_TW_CFG0_REG = ftwInterval;
1628   3                  CY_PM_TW_CFG2_REG |= CY_PM_FTW_EN;
1629   3              }   /* Required interval is already set */
1630   2          }
1631   1          else
1632   1          {
1633   2              /* Set new FTW counter interval if needed. FTW is disabled. */
1634   2              if(CY_PM_TW_CFG0_REG != ftwInterval)
1635   2              {
1636   3                  /* Set new CTW interval. Could be changed if CTW is disabled */
1637   3                  CY_PM_TW_CFG0_REG = ftwInterval;
1638   3              }   /* Required interval is already set */
1639   2      
1640   2              /* Enable FTW */
1641   2              CY_PM_TW_CFG2_REG |= CY_PM_FTW_EN;
1642   2          }
1643   1      }
1644          
1645          
1646          /*******************************************************************************
1647          * Function Name: CyPmHibSlpSaveSet
1648          ********************************************************************************
1649          *
1650          * Summary:
1651          *  This API is used for preparing the device for the Sleep and Hibernate low
1652          *  power modes entry:
1653          *  - Saves the COMP, VIDAC, DSM, and SAR routing connections (PSoC 5)
1654          *  - Saves the SC/CT routing connections (PSoC 3/5/5LP)
1655          *  - Disables the Serial Wire Viewer (SWV) (PSoC 3)
1656          *  - Saves the boost reference selection and sets it to internal
1657          *
1658          * Parameters:
1659          *  None
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 28  

1660          *
1661          * Return:
1662          *  None
1663          *
1664          * Reentrant:
1665          *  No
1666          *
1667          *******************************************************************************/
1668          static void CyPmHibSlpSaveSet(void) 
1669          {
1670   1          /* Save SC/CT routing registers */
1671   1          cyPmBackup.scctData[0u]   = CY_GET_REG8(CYREG_SC0_SW0 );
1672   1          cyPmBackup.scctData[1u]   = CY_GET_REG8(CYREG_SC0_SW2 );
1673   1          cyPmBackup.scctData[2u]   = CY_GET_REG8(CYREG_SC0_SW3 );
1674   1          cyPmBackup.scctData[3u]   = CY_GET_REG8(CYREG_SC0_SW4 );
1675   1          cyPmBackup.scctData[4u]   = CY_GET_REG8(CYREG_SC0_SW6 );
1676   1          cyPmBackup.scctData[5u]   = CY_GET_REG8(CYREG_SC0_SW8 );
1677   1          cyPmBackup.scctData[6u]   = CY_GET_REG8(CYREG_SC0_SW10);
1678   1      
1679   1          cyPmBackup.scctData[7u]   = CY_GET_REG8(CYREG_SC1_SW0 );
1680   1          cyPmBackup.scctData[8u]   = CY_GET_REG8(CYREG_SC1_SW2 );
1681   1          cyPmBackup.scctData[9u]   = CY_GET_REG8(CYREG_SC1_SW3 );
1682   1          cyPmBackup.scctData[10u]  = CY_GET_REG8(CYREG_SC1_SW4 );
1683   1          cyPmBackup.scctData[11u]  = CY_GET_REG8(CYREG_SC1_SW6 );
1684   1          cyPmBackup.scctData[12u]  = CY_GET_REG8(CYREG_SC1_SW8 );
1685   1          cyPmBackup.scctData[13u]  = CY_GET_REG8(CYREG_SC1_SW10);
1686   1      
1687   1          cyPmBackup.scctData[14u]  = CY_GET_REG8(CYREG_SC2_SW0 );
1688   1          cyPmBackup.scctData[15u]  = CY_GET_REG8(CYREG_SC2_SW2 );
1689   1          cyPmBackup.scctData[16u]  = CY_GET_REG8(CYREG_SC2_SW3 );
1690   1          cyPmBackup.scctData[17u]  = CY_GET_REG8(CYREG_SC2_SW4 );
1691   1          cyPmBackup.scctData[18u]  = CY_GET_REG8(CYREG_SC2_SW6 );
1692   1          cyPmBackup.scctData[19u]  = CY_GET_REG8(CYREG_SC2_SW8 );
1693   1          cyPmBackup.scctData[20u]  = CY_GET_REG8(CYREG_SC2_SW10);
1694   1      
1695   1          cyPmBackup.scctData[21u]  = CY_GET_REG8(CYREG_SC3_SW0 );
1696   1          cyPmBackup.scctData[22u]  = CY_GET_REG8(CYREG_SC3_SW2 );
1697   1          cyPmBackup.scctData[23u]  = CY_GET_REG8(CYREG_SC3_SW3 );
1698   1          cyPmBackup.scctData[24u]  = CY_GET_REG8(CYREG_SC3_SW4 );
1699   1          cyPmBackup.scctData[25u]  = CY_GET_REG8(CYREG_SC3_SW6 );
1700   1          cyPmBackup.scctData[26u]  = CY_GET_REG8(CYREG_SC3_SW8 );
1701   1          cyPmBackup.scctData[27u]  = CY_GET_REG8(CYREG_SC3_SW10);
1702   1      
1703   1          CY_SET_REG8(CYREG_SC0_SW0 , 0u);
1704   1          CY_SET_REG8(CYREG_SC0_SW2 , 0u);
1705   1          CY_SET_REG8(CYREG_SC0_SW3 , 0u);
1706   1          CY_SET_REG8(CYREG_SC0_SW4 , 0u);
1707   1          CY_SET_REG8(CYREG_SC0_SW6 , 0u);
1708   1          CY_SET_REG8(CYREG_SC0_SW8 , 0u);
1709   1          CY_SET_REG8(CYREG_SC0_SW10, 0u);
1710   1      
1711   1          CY_SET_REG8(CYREG_SC1_SW0 , 0u);
1712   1          CY_SET_REG8(CYREG_SC1_SW2 , 0u);
1713   1          CY_SET_REG8(CYREG_SC1_SW3 , 0u);
1714   1          CY_SET_REG8(CYREG_SC1_SW4 , 0u);
1715   1          CY_SET_REG8(CYREG_SC1_SW6 , 0u);
1716   1          CY_SET_REG8(CYREG_SC1_SW8 , 0u);
1717   1          CY_SET_REG8(CYREG_SC1_SW10, 0u);
1718   1      
1719   1          CY_SET_REG8(CYREG_SC2_SW0 , 0u);
1720   1          CY_SET_REG8(CYREG_SC2_SW2 , 0u);
1721   1          CY_SET_REG8(CYREG_SC2_SW3 , 0u);
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 29  

1722   1          CY_SET_REG8(CYREG_SC2_SW4 , 0u);
1723   1          CY_SET_REG8(CYREG_SC2_SW6 , 0u);
1724   1          CY_SET_REG8(CYREG_SC2_SW8 , 0u);
1725   1          CY_SET_REG8(CYREG_SC2_SW10, 0u);
1726   1      
1727   1          CY_SET_REG8(CYREG_SC3_SW0 , 0u);
1728   1          CY_SET_REG8(CYREG_SC3_SW2 , 0u);
1729   1          CY_SET_REG8(CYREG_SC3_SW3 , 0u);
1730   1          CY_SET_REG8(CYREG_SC3_SW4 , 0u);
1731   1          CY_SET_REG8(CYREG_SC3_SW6 , 0u);
1732   1          CY_SET_REG8(CYREG_SC3_SW8 , 0u);
1733   1          CY_SET_REG8(CYREG_SC3_SW10, 0u);
1734   1      
1735   1      
1736   1          #if(CY_PSOC3)
1737   1      
1738   1              /* Serial Wire Viewer (SWV) workaround */
1739   1      
1740   1              /* Disable SWV before entering low power mode */
1741   1              if(0u != (CY_PM_MLOGIC_DBG_REG & CY_PM_MLOGIC_DBG_SWV_CLK_EN))
1742   1              {
1743   2                  /* Save SWV clock enabled state */
1744   2                  cyPmBackup.swvClkEnabled = CY_PM_ENABLED;
1745   2      
1746   2                  /* Save current ports drive mode settings */
1747   2                  cyPmBackup.prt1Dm = CY_PM_PRT1_PC3_REG & ((uint8)(~CY_PM_PRT1_PC3_DM_MASK));
1748   2      
1749   2                  /* Set drive mode to strong output */
1750   2                  CY_PM_PRT1_PC3_REG = (CY_PM_PRT1_PC3_REG & CY_PM_PRT1_PC3_DM_MASK) |
1751   2                                      CY_PM_PRT1_PC3_DM_STRONG;
1752   2      
1753   2                  /* Disable SWV clocks */
1754   2                  CY_PM_MLOGIC_DBG_REG &= ((uint8)(~CY_PM_MLOGIC_DBG_SWV_CLK_EN));
1755   2              }
1756   1              else
1757   1              {
1758   2                  /* Save SWV clock disabled state */
1759   2                  cyPmBackup.swvClkEnabled = CY_PM_DISABLED;
1760   2              }
1761   1      
1762   1          #endif  /* (CY_PSOC3) */
1763   1      
1764   1      
1765   1          /***************************************************************************
1766   1          * Save boost reference and set it to boost's internal by clearing the bit.
1767   1          * External (chip bandgap) reference is not available in Sleep and Hibernate.
1768   1          ***************************************************************************/
1769   1          if(0u != (CY_PM_BOOST_CR2_REG & CY_PM_BOOST_CR2_EREFSEL_EXT))
1770   1          {
1771   2              cyPmBackup.boostRefExt = CY_PM_ENABLED;
1772   2              CY_PM_BOOST_CR2_REG &= ((uint8)(~CY_PM_BOOST_CR2_EREFSEL_EXT));
1773   2          }
1774   1          else
1775   1          {
1776   2              cyPmBackup.boostRefExt = CY_PM_DISABLED;
1777   2          }
1778   1      }
1779          
1780          
1781          /*******************************************************************************
1782          * Function Name: CyPmHibSlpRestore
1783          ********************************************************************************
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 30  

1784          *
1785          * Summary:
1786          *  This API is used for restoring the device configurations after wakeup from
1787          *  the Sleep and Hibernate low power modes:
1788          *  - Restores the SC/CT routing connections
1789          *  - Restores the enable state of the Serial Wire Viewer (SWV) (PSoC 3)
1790          *  - Restores the  boost reference selection
1791          *
1792          * Parameters:
1793          *  None
1794          *
1795          * Return:
1796          *  None
1797          *
1798          *******************************************************************************/
1799          static void CyPmHibSlpRestore(void) 
1800          {
1801   1          /* Restore SC/CT routing registers */
1802   1          CY_SET_REG8(CYREG_SC0_SW0 , cyPmBackup.scctData[0u] );
1803   1          CY_SET_REG8(CYREG_SC0_SW2 , cyPmBackup.scctData[1u] );
1804   1          CY_SET_REG8(CYREG_SC0_SW3 , cyPmBackup.scctData[2u] );
1805   1          CY_SET_REG8(CYREG_SC0_SW4 , cyPmBackup.scctData[3u] );
1806   1          CY_SET_REG8(CYREG_SC0_SW6 , cyPmBackup.scctData[4u] );
1807   1          CY_SET_REG8(CYREG_SC0_SW8 , cyPmBackup.scctData[5u] );
1808   1          CY_SET_REG8(CYREG_SC0_SW10, cyPmBackup.scctData[6u] );
1809   1      
1810   1          CY_SET_REG8(CYREG_SC1_SW0 , cyPmBackup.scctData[7u] );
1811   1          CY_SET_REG8(CYREG_SC1_SW2 , cyPmBackup.scctData[8u] );
1812   1          CY_SET_REG8(CYREG_SC1_SW3 , cyPmBackup.scctData[9u] );
1813   1          CY_SET_REG8(CYREG_SC1_SW4 , cyPmBackup.scctData[10u]);
1814   1          CY_SET_REG8(CYREG_SC1_SW6 , cyPmBackup.scctData[11u]);
1815   1          CY_SET_REG8(CYREG_SC1_SW8 , cyPmBackup.scctData[12u]);
1816   1          CY_SET_REG8(CYREG_SC1_SW10, cyPmBackup.scctData[13u]);
1817   1      
1818   1          CY_SET_REG8(CYREG_SC2_SW0 , cyPmBackup.scctData[14u]);
1819   1          CY_SET_REG8(CYREG_SC2_SW2 , cyPmBackup.scctData[15u]);
1820   1          CY_SET_REG8(CYREG_SC2_SW3 , cyPmBackup.scctData[16u]);
1821   1          CY_SET_REG8(CYREG_SC2_SW4 , cyPmBackup.scctData[17u]);
1822   1          CY_SET_REG8(CYREG_SC2_SW6 , cyPmBackup.scctData[18u]);
1823   1          CY_SET_REG8(CYREG_SC2_SW8 , cyPmBackup.scctData[19u]);
1824   1          CY_SET_REG8(CYREG_SC2_SW10, cyPmBackup.scctData[20u]);
1825   1      
1826   1          CY_SET_REG8(CYREG_SC3_SW0 , cyPmBackup.scctData[21u]);
1827   1          CY_SET_REG8(CYREG_SC3_SW2 , cyPmBackup.scctData[22u]);
1828   1          CY_SET_REG8(CYREG_SC3_SW3 , cyPmBackup.scctData[23u]);
1829   1          CY_SET_REG8(CYREG_SC3_SW4 , cyPmBackup.scctData[24u]);
1830   1          CY_SET_REG8(CYREG_SC3_SW6 , cyPmBackup.scctData[25u]);
1831   1          CY_SET_REG8(CYREG_SC3_SW8 , cyPmBackup.scctData[26u]);
1832   1          CY_SET_REG8(CYREG_SC3_SW10, cyPmBackup.scctData[27u]);
1833   1      
1834   1      
1835   1          #if(CY_PSOC3)
1836   1      
1837   1              /* Serial Wire Viewer (SWV) workaround */
1838   1              if(CY_PM_ENABLED == cyPmBackup.swvClkEnabled)
1839   1              {
1840   2                  /* Restore ports drive mode */
1841   2                  CY_PM_PRT1_PC3_REG = (CY_PM_PRT1_PC3_REG & CY_PM_PRT1_PC3_DM_MASK) |
1842   2                                          cyPmBackup.prt1Dm;
1843   2      
1844   2                  /* Enable SWV clocks */
1845   2                  CY_PM_MLOGIC_DBG_REG |= CY_PM_MLOGIC_DBG_SWV_CLK_EN;
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 31  

1846   2              }
1847   1      
1848   1          #endif /* (CY_PSOC3) */
1849   1      
1850   1      
1851   1          /* Restore boost reference */
1852   1          if(CY_PM_ENABLED == cyPmBackup.boostRefExt)
1853   1          {
1854   2              CY_PM_BOOST_CR2_REG |= CY_PM_BOOST_CR2_EREFSEL_EXT;
1855   2          }
1856   1      }
1857          
1858          
1859          /*******************************************************************************
1860          * Function Name: CyPmHviLviSaveDisable
1861          ********************************************************************************
1862          *
1863          * Summary:
1864          *  Saves analog and digital LVI and HVI configuration and disables them.
1865          *
1866          * Parameters:
1867          *  None
1868          *
1869          * Return:
1870          *  None
1871          *
1872          * Reentrant:
1873          *  No
1874          *
1875          *******************************************************************************/
1876          static void CyPmHviLviSaveDisable(void) 
1877          {
1878   1          if(0u != (CY_VD_LVI_HVI_CONTROL_REG & CY_VD_LVID_EN))
1879   1          {
1880   2              cyPmBackup.lvidEn = CY_PM_ENABLED;
1881   2              cyPmBackup.lvidTrip = CY_VD_LVI_TRIP_REG & CY_VD_LVI_TRIP_LVID_MASK;
1882   2      
1883   2              /* Save state of reset device at specified Vddd threshold */
1884   2              cyPmBackup.lvidRst = (0u == (CY_VD_PRES_CONTROL_REG & CY_VD_PRESD_EN)) ? \
1885   2                                   CY_PM_DISABLED : CY_PM_ENABLED;
1886   2      
1887   2              CyVdLvDigitDisable();
1888   2          }
1889   1          else
1890   1          {
1891   2              cyPmBackup.lvidEn = CY_PM_DISABLED;
1892   2          }
1893   1      
1894   1          if(0u != (CY_VD_LVI_HVI_CONTROL_REG & CY_VD_LVIA_EN))
1895   1          {
1896   2              cyPmBackup.lviaEn = CY_PM_ENABLED;
1897   2              cyPmBackup.lviaTrip = CY_VD_LVI_TRIP_REG >> 4u;
1898   2      
1899   2              /* Save state of reset device at specified Vdda threshold */
1900   2              cyPmBackup.lviaRst = (0u == (CY_VD_PRES_CONTROL_REG & CY_VD_PRESA_EN)) ? \
1901   2                                   CY_PM_DISABLED : CY_PM_ENABLED;
1902   2      
1903   2              CyVdLvAnalogDisable();
1904   2          }
1905   1          else
1906   1          {
1907   2              cyPmBackup.lviaEn = CY_PM_DISABLED;
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 32  

1908   2          }
1909   1      
1910   1          if(0u != (CY_VD_LVI_HVI_CONTROL_REG & CY_VD_HVIA_EN))
1911   1          {
1912   2              cyPmBackup.hviaEn = CY_PM_ENABLED;
1913   2              CyVdHvAnalogDisable();
1914   2          }
1915   1          else
1916   1          {
1917   2              cyPmBackup.hviaEn = CY_PM_DISABLED;
1918   2          }
1919   1      }
1920          
1921          
1922          /*******************************************************************************
1923          * Function Name: CyPmHviLviRestore
1924          ********************************************************************************
1925          *
1926          * Summary:
1927          *  Restores the analog and digital LVI and HVI configuration.
1928          *
1929          * Parameters:
1930          *  None
1931          *
1932          * Return:
1933          *  None
1934          *
1935          * Reentrant:
1936          *  No
1937          *
1938          *******************************************************************************/
1939          static void CyPmHviLviRestore(void) 
1940          {
1941   1          /* Restore LVI/HVI configuration */
1942   1          if(CY_PM_ENABLED == cyPmBackup.lvidEn)
1943   1          {
1944   2              CyVdLvDigitEnable(cyPmBackup.lvidRst, cyPmBackup.lvidTrip);
1945   2          }
1946   1      
1947   1          if(CY_PM_ENABLED == cyPmBackup.lviaEn)
1948   1          {
1949   2              CyVdLvAnalogEnable(cyPmBackup.lviaRst, cyPmBackup.lviaTrip);
1950   2          }
1951   1      
1952   1          if(CY_PM_ENABLED == cyPmBackup.hviaEn)
1953   1          {
1954   2              CyVdHvAnalogEnable();
1955   2          }
1956   1      }
1957          
1958          
1959          /* [] END OF FILE */
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 33  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION CyPmSaveClocks (BEGIN)
                                           ; SOURCE LINE # 84
                                           ; SOURCE LINE # 85
                                           ; SOURCE LINE # 87
0000 9043A1            MOV     DPTR,#043A1H
0003 E0                MOVX    A,@DPTR
0004 540F              ANL     A,#0FH
0006 900000      R     MOV     DPTR,#cyPmClockBackup
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 88
000A 9043A2            MOV     DPTR,#043A2H
000D E0                MOVX    A,@DPTR
000E 900000      R     MOV     DPTR,#cyPmClockBackup+01H
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 89
0012 9043A1            MOV     DPTR,#043A1H
0015 E0                MOVX    A,@DPTR
0016 54F0              ANL     A,#0F0H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 90
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B E4                CLR     A
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 93
001D 904800            MOV     DPTR,#04800H
0020 E0                MOVX    A,@DPTR
0021 54C0              ANL     A,#0C0H
0023 900000      R     MOV     DPTR,#cyPmClockBackup+05H
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 94
0027 7F2D              MOV     R7,#02DH
0029 120000      E     LCALL   _CyFlash_SetWaitCycles
                                           ; SOURCE LINE # 97
002C 904200            MOV     DPTR,#04200H
002F E0                MOVX    A,@DPTR
0030 5407              ANL     A,#07H
0032 900000      R     MOV     DPTR,#cyPmClockBackup+03H
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 98
0036 904200            MOV     DPTR,#04200H
0039 E0                MOVX    A,@DPTR
003A 5440              ANL     A,#040H
003C 900000      R     MOV     DPTR,#cyPmClockBackup+04H
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 101
0040 904200            MOV     DPTR,#04200H
0043 E0                MOVX    A,@DPTR
0044 5410              ANL     A,#010H
0046 6008              JZ      ?C0001
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 104
0048 900000      R     MOV     DPTR,#cyPmClockBackup+09H
004B 7401              MOV     A,#01H
004D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 105
004E 8005              SJMP    ?C0002
0050         ?C0001:
                                           ; SOURCE LINE # 107
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 34  

                                           ; SOURCE LINE # 109
0050 E4                CLR     A
0051 900000      R     MOV     DPTR,#cyPmClockBackup+09H
0054 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 110
0055         ?C0002:
                                           ; SOURCE LINE # 113
0055 904005            MOV     DPTR,#04005H
0058 E0                MOVX    A,@DPTR
0059 5403              ANL     A,#03H
005B 900000      R     MOV     DPTR,#cyPmClockBackup+02H
005E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 116
005F E0                MOVX    A,@DPTR
0060 B40123            CJNE    A,#01H,?C0003
                                           ; SOURCE LINE # 117
                                           ; SOURCE LINE # 118
0063 904000            MOV     DPTR,#04000H
0066 E0                MOVX    A,@DPTR
0067 5403              ANL     A,#03H
0069 14                DEC     A
006A 600E              JZ      ?C0006
006C 14                DEC     A
006D 6012              JZ      ?C0007
006F 2402              ADD     A,#02H
0071 7013              JNZ     ?C0003
                                           ; SOURCE LINE # 119
                                           ; SOURCE LINE # 120
0073         ?C0005:
                                           ; SOURCE LINE # 121
0073 E4                CLR     A
0074 FF                MOV     R7,A
0075 120000      E     LCALL   _CyMasterClk_SetSource
                                           ; SOURCE LINE # 122
0078 800C              SJMP    ?C0003
                                           ; SOURCE LINE # 124
007A         ?C0006:
                                           ; SOURCE LINE # 125
007A 7F02              MOV     R7,#02H
007C 120000      E     LCALL   _CyMasterClk_SetSource
                                           ; SOURCE LINE # 126
007F 8005              SJMP    ?C0003
                                           ; SOURCE LINE # 128
0081         ?C0007:
                                           ; SOURCE LINE # 129
0081 7F03              MOV     R7,#03H
0083 120000      E     LCALL   _CyMasterClk_SetSource
                                           ; SOURCE LINE # 130
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 134
                                           ; SOURCE LINE # 135
                                           ; SOURCE LINE # 136
0086         ?C0003:
                                           ; SOURCE LINE # 139
0086 904220            MOV     DPTR,#04220H
0089 E0                MOVX    A,@DPTR
008A 5401              ANL     A,#01H
008C 600B              JZ      ?C0009
                                           ; SOURCE LINE # 140
                                           ; SOURCE LINE # 142
008E 900000      R     MOV     DPTR,#cyPmClockBackup+0DH
0091 7401              MOV     A,#01H
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 35  

0093 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 143
0094 120000      E     LCALL   CyPLL_OUT_Stop
                                           ; SOURCE LINE # 144
0097 8005              SJMP    ?C0010
0099         ?C0009:
                                           ; SOURCE LINE # 146
                                           ; SOURCE LINE # 148
0099 E4                CLR     A
009A 900000      R     MOV     DPTR,#cyPmClockBackup+0DH
009D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 149
009E         ?C0010:
                                           ; SOURCE LINE # 152
009E 7F04              MOV     R7,#04H
00A0 120000      E     LCALL   _CyIMO_SetFreq
                                           ; SOURCE LINE # 155
00A3 9043A0            MOV     DPTR,#043A0H
00A6 E0                MOVX    A,@DPTR
00A7 5410              ANL     A,#010H
00A9 6008              JZ      ?C0011
                                           ; SOURCE LINE # 156
                                           ; SOURCE LINE # 158
00AB 900000      R     MOV     DPTR,#cyPmClockBackup+06H
00AE 7401              MOV     A,#01H
00B0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 159
00B1 8010              SJMP    ?C0012
00B3         ?C0011:
                                           ; SOURCE LINE # 161
                                           ; SOURCE LINE # 163
00B3 E4                CLR     A
00B4 900000      R     MOV     DPTR,#cyPmClockBackup+06H
00B7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 166
00B8 FF                MOV     R7,A
00B9 120000      E     LCALL   _CyIMO_Start
                                           ; SOURCE LINE # 169
00BC 7F06              MOV     R7,#06H
00BE 7E00              MOV     R6,#00H
00C0 120000      E     LCALL   _CyDelayUs
                                           ; SOURCE LINE # 170
00C3         ?C0012:
                                           ; SOURCE LINE # 173
00C3 904200            MOV     DPTR,#04200H
00C6 E0                MOVX    A,@DPTR
00C7 5420              ANL     A,#020H
00C9 601A              JZ      ?C0013
                                           ; SOURCE LINE # 174
                                           ; SOURCE LINE # 177
00CB 904000            MOV     DPTR,#04000H
00CE E0                MOVX    A,@DPTR
00CF 5440              ANL     A,#040H
00D1 7004              JNZ     ?C0014
00D3 7F02              MOV     R7,#02H
00D5 8002              SJMP    ?C0015
00D7         ?C0014:
00D7 7F01              MOV     R7,#01H
00D9         ?C0015:
00D9 900000      R     MOV     DPTR,#cyPmClockBackup+07H
00DC EF                MOV     A,R7
00DD F0                MOVX    @DPTR,A
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 36  

                                           ; SOURCE LINE # 180
00DE E4                CLR     A
00DF FF                MOV     R7,A
00E0 120000      E     LCALL   _CyIMO_SetSource
                                           ; SOURCE LINE # 181
00E3 8005              SJMP    ?C0016
00E5         ?C0013:
                                           ; SOURCE LINE # 183
                                           ; SOURCE LINE # 185
00E5 E4                CLR     A
00E6 900000      R     MOV     DPTR,#cyPmClockBackup+07H
00E9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 186
00EA         ?C0016:
                                           ; SOURCE LINE # 189
00EA 904000            MOV     DPTR,#04000H
00ED E0                MOVX    A,@DPTR
00EE 5430              ANL     A,#030H
00F0 900000      R     MOV     DPTR,#cyPmClockBackup+08H
00F3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 192
00F4 E0                MOVX    A,@DPTR
00F5 6007              JZ      ?C0017
                                           ; SOURCE LINE # 193
                                           ; SOURCE LINE # 195
00F7 904000            MOV     DPTR,#04000H
00FA E0                MOVX    A,@DPTR
00FB 54CF              ANL     A,#0CFH
00FD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 197
00FE         ?C0017:
                                           ; SOURCE LINE # 200
00FE 904200            MOV     DPTR,#04200H
0101 E0                MOVX    A,@DPTR
0102 5410              ANL     A,#010H
0104 6003              JZ      ?C0018
                                           ; SOURCE LINE # 201
                                           ; SOURCE LINE # 202
0106 120000      E     LCALL   CyIMO_DisableDoubler
                                           ; SOURCE LINE # 203
0109         ?C0018:
                                           ; SOURCE LINE # 206
0109 904004            MOV     DPTR,#04004H
010C E0                MOVX    A,@DPTR
010D 900000      R     MOV     DPTR,#cyPmClockBackup+0AH
0110 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 207
0111 E0                MOVX    A,@DPTR
0112 6005              JZ      ?C0019
                                           ; SOURCE LINE # 208
                                           ; SOURCE LINE # 209
0114 E4                CLR     A
0115 FF                MOV     R7,A
0116 120000      E     LCALL   _CyMasterClk_SetDivider
                                           ; SOURCE LINE # 210
0119         ?C0019:
                                           ; SOURCE LINE # 213
0119 900000      R     MOV     DPTR,#cyPmClockBackup+02H
011C E0                MOVX    A,@DPTR
011D 6005              JZ      ?C0020
                                           ; SOURCE LINE # 214
                                           ; SOURCE LINE # 215
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 37  

011F E4                CLR     A
0120 FF                MOV     R7,A
0121 120000      E     LCALL   _CyMasterClk_SetSource
                                           ; SOURCE LINE # 216
0124         ?C0020:
                                           ; SOURCE LINE # 219
0124 904007            MOV     DPTR,#04007H
0127 E0                MOVX    A,@DPTR
0128 900000      R     MOV     DPTR,#cyPmClockBackup+0BH
012B F0                MOVX    @DPTR,A
012C A3                INC     DPTR
012D E4                CLR     A
012E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 220
012F 904006            MOV     DPTR,#04006H
0132 E0                MOVX    A,@DPTR
0133 FF                MOV     R7,A
0134 900000      R     MOV     DPTR,#cyPmClockBackup+0BH
0137 E0                MOVX    A,@DPTR
0138 F0                MOVX    @DPTR,A
0139 A3                INC     DPTR
013A E0                MOVX    A,@DPTR
013B 4F                ORL     A,R7
013C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 221
013D 900000      R     MOV     DPTR,#cyPmClockBackup+0BH
0140 E0                MOVX    A,@DPTR
0141 7002              JNZ     ?C0132
0143 A3                INC     DPTR
0144 E0                MOVX    A,@DPTR
0145         ?C0132:
0145 6006              JZ      ?C0021
                                           ; SOURCE LINE # 222
                                           ; SOURCE LINE # 223
0147 E4                CLR     A
0148 FF                MOV     R7,A
0149 FE                MOV     R6,A
014A 120000      E     LCALL   _CyBusClk_SetDivider
                                           ; SOURCE LINE # 224
014D         ?C0021:
                                           ; SOURCE LINE # 227
014D 904005            MOV     DPTR,#04005H
0150 E0                MOVX    A,@DPTR
0151 54F0              ANL     A,#0F0H
0153 FF                MOV     R7,A
0154 E4                CLR     A
0155 C4                SWAP    A
0156 F8                MOV     R0,A
0157 54F0              ANL     A,#0F0H
0159 C8                XCH     A,R0
015A 68                XRL     A,R0
015B EF                MOV     A,R7
015C C4                SWAP    A
015D 540F              ANL     A,#0FH
015F 48                ORL     A,R0
0160 04                INC     A
0161 FF                MOV     R7,A
0162 FB                MOV     R3,A
0163 E4                CLR     A
0164 FA                MOV     R2,A
0165 F9                MOV     R1,A
0166 F8                MOV     R0,A
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 38  

0167 904200            MOV     DPTR,#04200H
016A E0                MOVX    A,@DPTR
016B 5407              ANL     A,#07H
016D 900000      R     MOV     DPTR,#cyPmImoFreqReg2Mhz
0170 93                MOVC    A,@A+DPTR
0171 FF                MOV     R7,A
0172 E4                CLR     A
0173 FC                MOV     R4,A
0174 FD                MOV     R5,A
0175 FE                MOV     R6,A
0176 120000      E     LCALL   ?C?ULDIV
0179 120000      E     LCALL   _CyFlash_SetWaitCycles
                                           ; SOURCE LINE # 230
017C 904210            MOV     DPTR,#04210H
017F E0                MOVX    A,@DPTR
0180 5401              ANL     A,#01H
0182 600B              JZ      ?C0022
                                           ; SOURCE LINE # 231
                                           ; SOURCE LINE # 233
0184 900000      R     MOV     DPTR,#cyPmClockBackup+0EH
0187 7401              MOV     A,#01H
0189 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 234
018A 120000      E     LCALL   CyXTAL_Stop
                                           ; SOURCE LINE # 235
018D 8005              SJMP    ?C0023
018F         ?C0022:
                                           ; SOURCE LINE # 237
                                           ; SOURCE LINE # 239
018F E4                CLR     A
0190 900000      R     MOV     DPTR,#cyPmClockBackup+0EH
0193 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 240
0194         ?C0023:
                                           ; SOURCE LINE # 248
0194 90400B            MOV     DPTR,#0400BH
0197 E0                MOVX    A,@DPTR
0198 5404              ANL     A,#04H
019A 6007              JZ      ?C0024
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 250
019C 900000      R     MOV     DPTR,#cyPmClockBackup+0FH
019F 7401              MOV     A,#01H
01A1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 251
01A2 22                RET     
01A3         ?C0024:
                                           ; SOURCE LINE # 253
                                           ; SOURCE LINE # 254
01A3 E4                CLR     A
01A4 900000      R     MOV     DPTR,#cyPmClockBackup+0FH
01A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 255
                                           ; SOURCE LINE # 256
01A8         ?C0026:
01A8 22                RET     
             ; FUNCTION CyPmSaveClocks (END)

             ; FUNCTION CyPmRestoreClocks (BEGIN)
                                           ; SOURCE LINE # 286
                                           ; SOURCE LINE # 287
                                           ; SOURCE LINE # 288
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 39  

0000 900000      R     MOV     DPTR,#status
0003 7410              MOV     A,#010H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 299
0006 900000      R     MOV     DPTR,#cyPmClockBackup+0FH
0009 E0                MOVX    A,@DPTR
000A 6401              XRL     A,#01H
000C 703F              JNZ     ?C0027
                                           ; SOURCE LINE # 300
                                           ; SOURCE LINE # 303
000E 904005            MOV     DPTR,#04005H
0011 E0                MOVX    A,@DPTR
0012 54F0              ANL     A,#0F0H
0014 FF                MOV     R7,A
0015 E4                CLR     A
0016 C4                SWAP    A
0017 F8                MOV     R0,A
0018 54F0              ANL     A,#0F0H
001A C8                XCH     A,R0
001B 68                XRL     A,R0
001C EF                MOV     A,R7
001D C4                SWAP    A
001E 540F              ANL     A,#0FH
0020 48                ORL     A,R0
0021 04                INC     A
0022 FF                MOV     R7,A
0023 FB                MOV     R3,A
0024 E4                CLR     A
0025 FA                MOV     R2,A
0026 F9                MOV     R1,A
0027 F8                MOV     R0,A
0028 904200            MOV     DPTR,#04200H
002B E0                MOVX    A,@DPTR
002C 5407              ANL     A,#07H
002E 900000      R     MOV     DPTR,#cyPmImoFreqReg2Mhz
0031 93                MOVC    A,@A+DPTR
0032 FF                MOV     R7,A
0033 E4                CLR     A
0034 FC                MOV     R4,A
0035 FD                MOV     R5,A
0036 FE                MOV     R6,A
0037 120000      E     LCALL   ?C?ULDIV
003A E4                CLR     A
003B 7B4B              MOV     R3,#04BH
003D FA                MOV     R2,A
003E F9                MOV     R1,A
003F F8                MOV     R0,A
0040 120000      E     LCALL   ?C?LMUL
0043 120000      E     LCALL   _CyDelayCycles
                                           ; SOURCE LINE # 305
0046 90400B            MOV     DPTR,#0400BH
0049 E0                MOVX    A,@DPTR
004A 4404              ORL     A,#04H
004C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 306
004D         ?C0027:
                                           ; SOURCE LINE # 309
004D 900000      R     MOV     DPTR,#cyPmClockBackup+0EH
0050 E0                MOVX    A,@DPTR
0051 6401              XRL     A,#01H
0053 7077              JNZ     ?C0028
                                           ; SOURCE LINE # 310
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 40  

                                           ; SOURCE LINE # 319
0055 FF                MOV     R7,A
0056 120000      E     LCALL   _CyXTAL_Start
                                           ; SOURCE LINE # 322
0059 904210            MOV     DPTR,#04210H
005C E0                MOVX    A,@DPTR
005D FF                MOV     R7,A
                                           ; SOURCE LINE # 325
005E 900000      R     MOV     DPTR,#i
0061 E4                CLR     A
0062 F0                MOVX    @DPTR,A
0063 A3                INC     DPTR
0064 7405              MOV     A,#05H
0066 F0                MOVX    @DPTR,A
0067         ?C0029:
0067 D3                SETB    C
0068 900000      R     MOV     DPTR,#i+01H
006B E0                MOVX    A,@DPTR
006C 9400              SUBB    A,#00H
006E 900000      R     MOV     DPTR,#i
0071 E0                MOVX    A,@DPTR
0072 9400              SUBB    A,#00H
0074 4056              JC      ?C0030
                                           ; SOURCE LINE # 326
                                           ; SOURCE LINE # 328
0076 904005            MOV     DPTR,#04005H
0079 E0                MOVX    A,@DPTR
007A 54F0              ANL     A,#0F0H
007C FF                MOV     R7,A
007D E4                CLR     A
007E C4                SWAP    A
007F F8                MOV     R0,A
0080 54F0              ANL     A,#0F0H
0082 C8                XCH     A,R0
0083 68                XRL     A,R0
0084 EF                MOV     A,R7
0085 C4                SWAP    A
0086 540F              ANL     A,#0FH
0088 48                ORL     A,R0
0089 04                INC     A
008A FF                MOV     R7,A
008B FB                MOV     R3,A
008C E4                CLR     A
008D FA                MOV     R2,A
008E F9                MOV     R1,A
008F F8                MOV     R0,A
0090 904200            MOV     DPTR,#04200H
0093 E0                MOVX    A,@DPTR
0094 5407              ANL     A,#07H
0096 900000      R     MOV     DPTR,#cyPmImoFreqReg2Mhz
0099 93                MOVC    A,@A+DPTR
009A FF                MOV     R7,A
009B E4                CLR     A
009C FC                MOV     R4,A
009D FD                MOV     R5,A
009E FE                MOV     R6,A
009F 120000      E     LCALL   ?C?ULDIV
00A2 E4                CLR     A
00A3 7BC8              MOV     R3,#0C8H
00A5 FA                MOV     R2,A
00A6 F9                MOV     R1,A
00A7 F8                MOV     R0,A
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 41  

00A8 120000      E     LCALL   ?C?LMUL
00AB 120000      E     LCALL   _CyDelayCycles
                                           ; SOURCE LINE # 331
00AE 904210            MOV     DPTR,#04210H
00B1 E0                MOVX    A,@DPTR
00B2 5480              ANL     A,#080H
00B4 7006              JNZ     ?C0031
                                           ; SOURCE LINE # 332
                                           ; SOURCE LINE # 333
00B6 900000      R     MOV     DPTR,#status
00B9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 334
00BA 8010              SJMP    ?C0030
                                           ; SOURCE LINE # 335
                                           ; SOURCE LINE # 336
00BC         ?C0031:
00BC 900000      R     MOV     DPTR,#i+01H
00BF E0                MOVX    A,@DPTR
00C0 24FF              ADD     A,#0FFH
00C2 F0                MOVX    @DPTR,A
00C3 900000      R     MOV     DPTR,#i
00C6 E0                MOVX    A,@DPTR
00C7 34FF              ADDC    A,#0FFH
00C9 F0                MOVX    @DPTR,A
00CA 809B              SJMP    ?C0029
00CC         ?C0030:
                                           ; SOURCE LINE # 338
                                           ; SOURCE LINE # 339
                                           ; SOURCE LINE # 351
                                           ; SOURCE LINE # 352
00CC         ?C0028:
                                           ; SOURCE LINE # 356
00CC 7F2D              MOV     R7,#02DH
00CE 120000      E     LCALL   _CyFlash_SetWaitCycles
                                           ; SOURCE LINE # 359
00D1 900000      R     MOV     DPTR,#cyPmClockBackup+02H
00D4 E0                MOVX    A,@DPTR
00D5 FF                MOV     R7,A
00D6 6402              XRL     A,#02H
00D8 6004              JZ      ?C0035
00DA EF                MOV     A,R7
00DB B40317            CJNE    A,#03H,?C0034
00DE         ?C0035:
                                           ; SOURCE LINE # 361
                                           ; SOURCE LINE # 363
00DE 900000      R     MOV     DPTR,#cyPmClockBackup+0AH
00E1 E0                MOVX    A,@DPTR
00E2 FF                MOV     R7,A
00E3 904004            MOV     DPTR,#04004H
00E6 E0                MOVX    A,@DPTR
00E7 6F                XRL     A,R7
00E8 6003              JZ      ?C0036
                                           ; SOURCE LINE # 364
                                           ; SOURCE LINE # 366
00EA 120000      E     LCALL   _CyMasterClk_SetDivider
                                           ; SOURCE LINE # 367
00ED         ?C0036:
                                           ; SOURCE LINE # 370
00ED 900000      R     MOV     DPTR,#cyPmClockBackup+02H
00F0 E0                MOVX    A,@DPTR
00F1 FF                MOV     R7,A
00F2 120000      E     LCALL   _CyMasterClk_SetSource
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 42  

                                           ; SOURCE LINE # 371
00F5         ?C0034:
                                           ; SOURCE LINE # 374
00F5 900000      R     MOV     DPTR,#cyPmClockBackup+04H
00F8 E0                MOVX    A,@DPTR
00F9 5440              ANL     A,#040H
00FB 6012              JZ      ?C0037
00FD 900000      R     MOV     DPTR,#cyPmClockBackup+03H
0100 E0                MOVX    A,@DPTR
0101 900000      R     MOV     DPTR,#cyPmImoFreqMhz2Reg
0104 93                MOVC    A,@A+DPTR
0105 B40307            CJNE    A,#03H,?C0037
                                           ; SOURCE LINE # 376
                                           ; SOURCE LINE # 378
0108 7F08              MOV     R7,#08H
010A 120000      E     LCALL   _CyIMO_SetFreq
                                           ; SOURCE LINE # 379
010D 8024              SJMP    ?C0038
010F         ?C0037:
                                           ; SOURCE LINE # 381
                                           ; SOURCE LINE # 383
010F 900000      R     MOV     DPTR,#cyPmClockBackup+03H
0112 E0                MOVX    A,@DPTR
0113 900000      R     MOV     DPTR,#cyPmImoFreqMhz2Reg
0116 93                MOVC    A,@A+DPTR
0117 FF                MOV     R7,A
0118 120000      E     LCALL   _CyIMO_SetFreq
                                           ; SOURCE LINE # 385
011B 900000      R     MOV     DPTR,#cyPmClockBackup+04H
011E E0                MOVX    A,@DPTR
011F 5440              ANL     A,#040H
0121 6009              JZ      ?C0039
                                           ; SOURCE LINE # 386
                                           ; SOURCE LINE # 387
0123 904200            MOV     DPTR,#04200H
0126 E0                MOVX    A,@DPTR
0127 4440              ORL     A,#040H
0129 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 388
012A 8007              SJMP    ?C0038
012C         ?C0039:
                                           ; SOURCE LINE # 390
                                           ; SOURCE LINE # 391
012C 904200            MOV     DPTR,#04200H
012F E0                MOVX    A,@DPTR
0130 54BF              ANL     A,#0BFH
0132 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 392
                                           ; SOURCE LINE # 393
0133         ?C0038:
                                           ; SOURCE LINE # 397
0133 900000      R     MOV     DPTR,#cyPmClockBackup+06H
0136 E0                MOVX    A,@DPTR
0137 B4010C            CJNE    A,#01H,?C0041
013A 9043A0            MOV     DPTR,#043A0H
013D E0                MOVX    A,@DPTR
013E 5410              ANL     A,#010H
0140 7004              JNZ     ?C0041
                                           ; SOURCE LINE # 398
                                           ; SOURCE LINE # 400
0142 FF                MOV     R7,A
0143 120000      E     LCALL   _CyIMO_Start
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 43  

                                           ; SOURCE LINE # 401
0146         ?C0041:
                                           ; SOURCE LINE # 404
0146 900000      R     MOV     DPTR,#cyPmClockBackup+07H
0149 E0                MOVX    A,@DPTR
014A FF                MOV     R7,A
014B 120000      E     LCALL   _CyIMO_SetSource
                                           ; SOURCE LINE # 407
014E 900000      R     MOV     DPTR,#cyPmClockBackup+09H
0151 E0                MOVX    A,@DPTR
0152 B40103            CJNE    A,#01H,?C0042
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 409
0155 120000      E     LCALL   CyIMO_EnableDoubler
                                           ; SOURCE LINE # 410
0158         ?C0042:
                                           ; SOURCE LINE # 413
0158 904000            MOV     DPTR,#04000H
015B E0                MOVX    A,@DPTR
015C 5430              ANL     A,#030H
015E FF                MOV     R7,A
015F 900000      R     MOV     DPTR,#cyPmClockBackup+08H
0162 E0                MOVX    A,@DPTR
0163 FD                MOV     R5,A
0164 6F                XRL     A,R7
0165 7001              JNZ     ?C0133
0167 E4                CLR     A
0168         ?C0133:
0168 600A              JZ      ?C0043
                                           ; SOURCE LINE # 414
                                           ; SOURCE LINE # 415
016A 904000            MOV     DPTR,#04000H
016D E0                MOVX    A,@DPTR
016E 54CF              ANL     A,#0CFH
0170 FF                MOV     R7,A
0171 ED                MOV     A,R5
0172 4F                ORL     A,R7
0173 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 417
0174         ?C0043:
                                           ; SOURCE LINE # 421
0174 900000      R     MOV     DPTR,#cyPmClockBackup+0DH
0177 E0                MOVX    A,@DPTR
0178 6401              XRL     A,#01H
017A 705A              JNZ     ?C0044
                                           ; SOURCE LINE # 422
                                           ; SOURCE LINE # 429
017C 900000      R     MOV     DPTR,#status
017F 7410              MOV     A,#010H
0181 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 432
0182 E4                CLR     A
0183 FF                MOV     R7,A
0184 120000      E     LCALL   _CyPLL_OUT_Start
                                           ; SOURCE LINE # 435
0187 7F50              MOV     R7,#050H
0189 7E00              MOV     R6,#00H
018B 120000      E     LCALL   _CyDelayUs
                                           ; SOURCE LINE # 436
018E 904225            MOV     DPTR,#04225H
0191 E0                MOVX    A,@DPTR
0192 FF                MOV     R7,A
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 44  

                                           ; SOURCE LINE # 439
0193 900000      R     MOV     DPTR,#i
0196 E4                CLR     A
0197 F0                MOVX    @DPTR,A
0198 A3                INC     DPTR
0199 74AB              MOV     A,#0ABH
019B F0                MOVX    @DPTR,A
019C         ?C0045:
019C D3                SETB    C
019D 900000      R     MOV     DPTR,#i+01H
01A0 E0                MOVX    A,@DPTR
01A1 9400              SUBB    A,#00H
01A3 900000      R     MOV     DPTR,#i
01A6 E0                MOVX    A,@DPTR
01A7 9400              SUBB    A,#00H
01A9 402B              JC      ?C0046
                                           ; SOURCE LINE # 440
                                           ; SOURCE LINE # 441
01AB 7F01              MOV     R7,#01H
01AD 7E00              MOV     R6,#00H
01AF 120000      E     LCALL   _CyDelayUs
                                           ; SOURCE LINE # 445
01B2 904225            MOV     DPTR,#04225H
01B5 E0                MOVX    A,@DPTR
01B6 5401              ANL     A,#01H
01B8 600C              JZ      ?C0047
01BA E0                MOVX    A,@DPTR
01BB 5401              ANL     A,#01H
01BD 6007              JZ      ?C0047
                                           ; SOURCE LINE # 446
                                           ; SOURCE LINE # 447
01BF E4                CLR     A
01C0 900000      R     MOV     DPTR,#status
01C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 448
01C4 8010              SJMP    ?C0046
                                           ; SOURCE LINE # 449
                                           ; SOURCE LINE # 450
01C6         ?C0047:
01C6 900000      R     MOV     DPTR,#i+01H
01C9 E0                MOVX    A,@DPTR
01CA 24FF              ADD     A,#0FFH
01CC F0                MOVX    @DPTR,A
01CD 900000      R     MOV     DPTR,#i
01D0 E0                MOVX    A,@DPTR
01D1 34FF              ADDC    A,#0FFH
01D3 F0                MOVX    @DPTR,A
01D4 80C6              SJMP    ?C0045
01D6         ?C0046:
                                           ; SOURCE LINE # 452
                                           ; SOURCE LINE # 453
                                           ; SOURCE LINE # 464
                                           ; SOURCE LINE # 465
01D6         ?C0044:
                                           ; SOURCE LINE # 469
01D6 900000      R     MOV     DPTR,#cyPmClockBackup+02H
01D9 E0                MOVX    A,@DPTR
01DA FF                MOV     R7,A
01DB 6003              JZ      ?C0051
01DD B40117            CJNE    A,#01H,?C0050
01E0         ?C0051:
                                           ; SOURCE LINE # 471
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 45  

                                           ; SOURCE LINE # 473
01E0 900000      R     MOV     DPTR,#cyPmClockBackup+0AH
01E3 E0                MOVX    A,@DPTR
01E4 FF                MOV     R7,A
01E5 904004            MOV     DPTR,#04004H
01E8 E0                MOVX    A,@DPTR
01E9 6F                XRL     A,R7
01EA 6003              JZ      ?C0052
                                           ; SOURCE LINE # 474
                                           ; SOURCE LINE # 475
01EC 120000      E     LCALL   _CyMasterClk_SetDivider
                                           ; SOURCE LINE # 476
01EF         ?C0052:
                                           ; SOURCE LINE # 479
01EF 900000      R     MOV     DPTR,#cyPmClockBackup+02H
01F2 E0                MOVX    A,@DPTR
01F3 FF                MOV     R7,A
01F4 120000      E     LCALL   _CyMasterClk_SetSource
                                           ; SOURCE LINE # 480
01F7         ?C0050:
                                           ; SOURCE LINE # 484
01F7 900000      R     MOV     DPTR,#cyPmClockBackup+06H
01FA E0                MOVX    A,@DPTR
01FB 700B              JNZ     ?C0053
01FD 9043A0            MOV     DPTR,#043A0H
0200 E0                MOVX    A,@DPTR
0201 5410              ANL     A,#010H
0203 6003              JZ      ?C0053
                                           ; SOURCE LINE # 485
                                           ; SOURCE LINE # 486
0205 120000      E     LCALL   CyIMO_Stop
                                           ; SOURCE LINE # 487
0208         ?C0053:
                                           ; SOURCE LINE # 490
0208 904007            MOV     DPTR,#04007H
020B E0                MOVX    A,@DPTR
020C 7F00              MOV     R7,#00H
020E FE                MOV     R6,A
;---- Variable 'clkBusDivTmp' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 491
020F 904006            MOV     DPTR,#04006H
0212 E0                MOVX    A,@DPTR
0213 FD                MOV     R5,A
0214 EE                MOV     A,R6
0215 ED                MOV     A,R5
0216 FF                MOV     R7,A
                                           ; SOURCE LINE # 492
0217 AC06              MOV     R4,AR6
0219 900000      R     MOV     DPTR,#cyPmClockBackup+0BH
021C E0                MOVX    A,@DPTR
021D FE                MOV     R6,A
021E A3                INC     DPTR
021F E0                MOVX    A,@DPTR
0220 FF                MOV     R7,A
0221 6D                XRL     A,R5
0222 7002              JNZ     ?C0134
0224 EE                MOV     A,R6
0225 6C                XRL     A,R4
0226         ?C0134:
0226 6003              JZ      ?C0054
                                           ; SOURCE LINE # 493
                                           ; SOURCE LINE # 494
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 46  

0228 120000      E     LCALL   _CyBusClk_SetDivider
                                           ; SOURCE LINE # 495
022B         ?C0054:
                                           ; SOURCE LINE # 498
022B 904800            MOV     DPTR,#04800H
022E E0                MOVX    A,@DPTR
022F 543F              ANL     A,#03FH
0231 FF                MOV     R7,A
0232 900000      R     MOV     DPTR,#cyPmClockBackup+05H
0235 E0                MOVX    A,@DPTR
0236 4F                ORL     A,R7
0237 904800            MOV     DPTR,#04800H
023A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 502
023B 900000      R     MOV     DPTR,#cyPmClockBackup
023E E0                MOVX    A,@DPTR
023F 9043A1            MOV     DPTR,#043A1H
0242 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 503
0243 900000      R     MOV     DPTR,#cyPmClockBackup+01H
0246 E0                MOVX    A,@DPTR
0247 9043A2            MOV     DPTR,#043A2H
024A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 504
024B 22                RET     
             ; FUNCTION CyPmRestoreClocks (END)

             ; FUNCTION _CyPmAltAct (BEGIN)
                                           ; SOURCE LINE # 648
0000 900000      R     MOV     DPTR,#wakeupSource
0003 EC                MOV     A,R4
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
0008 900000      R     MOV     DPTR,#wakeupTime
000B EE                MOV     A,R6
000C F0                MOVX    @DPTR,A
000D A3                INC     DPTR
000E EF                MOV     A,R7
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 649
                                           ; SOURCE LINE # 666
0010 C3                CLR     C
0011 940F              SUBB    A,#0FH
0013 EE                MOV     A,R6
0014 9400              SUBB    A,#00H
0016 4021              JC      ?C0056
0018 900000      R     MOV     DPTR,#wakeupTime
001B E0                MOVX    A,@DPTR
001C FE                MOV     R6,A
001D A3                INC     DPTR
001E E0                MOVX    A,@DPTR
001F FF                MOV     R7,A
0020 D3                SETB    C
0021 940E              SUBB    A,#0EH
0023 EE                MOV     A,R6
0024 9401              SUBB    A,#01H
0026 5011              JNC     ?C0056
                                           ; SOURCE LINE # 667
                                           ; SOURCE LINE # 668
0028 EF                MOV     A,R7
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 47  

0029 24F2              ADD     A,#0F2H
002B FF                MOV     R7,A
002C 120000      R     LCALL   _CyPmFtwSetInterval
                                           ; SOURCE LINE # 671
002F 900000      R     MOV     DPTR,#wakeupSource
0032 E0                MOVX    A,@DPTR
0033 4404              ORL     A,#04H
0035 F0                MOVX    @DPTR,A
0036 A3                INC     DPTR
0037 E0                MOVX    A,@DPTR
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 672
0039         ?C0056:
                                           ; SOURCE LINE # 675
0039 900000      R     MOV     DPTR,#wakeupTime
003C E0                MOVX    A,@DPTR
003D FE                MOV     R6,A
003E A3                INC     DPTR
003F E0                MOVX    A,@DPTR
0040 FF                MOV     R7,A
0041 C3                CLR     C
0042 9402              SUBB    A,#02H
0044 EE                MOV     A,R6
0045 9400              SUBB    A,#00H
0047 4019              JC      ?C0057
0049 D3                SETB    C
004A EF                MOV     A,R7
004B 940D              SUBB    A,#0DH
004D EE                MOV     A,R6
004E 9400              SUBB    A,#00H
0050 5010              JNC     ?C0057
                                           ; SOURCE LINE # 676
                                           ; SOURCE LINE # 678
0052 EF                MOV     A,R7
0053 14                DEC     A
0054 FF                MOV     R7,A
0055 120000      R     LCALL   _CyPmCtwSetInterval
                                           ; SOURCE LINE # 681
0058 900000      R     MOV     DPTR,#wakeupSource
005B E0                MOVX    A,@DPTR
005C 4408              ORL     A,#08H
005E F0                MOVX    @DPTR,A
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 682
0062         ?C0057:
                                           ; SOURCE LINE # 685
0062 900000      R     MOV     DPTR,#wakeupTime
0065 E0                MOVX    A,@DPTR
0066 7004              JNZ     ?C0135
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A 6401              XRL     A,#01H
006C         ?C0135:
006C 700D              JNZ     ?C0058
                                           ; SOURCE LINE # 686
                                           ; SOURCE LINE # 688
006E 120000      R     LCALL   CyPmOppsSet
                                           ; SOURCE LINE # 691
0071 900000      R     MOV     DPTR,#wakeupSource
0074 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 48  

0075 4408              ORL     A,#08H
0077 F0                MOVX    @DPTR,A
0078 A3                INC     DPTR
0079 E0                MOVX    A,@DPTR
007A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 692
007B         ?C0058:
                                           ; SOURCE LINE # 700
007B 904398            MOV     DPTR,#04398H
007E E0                MOVX    A,@DPTR
007F 900000      R     MOV     DPTR,#cyPmBackup+07H
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 701
0083 900000      R     MOV     DPTR,#wakeupSource
0086 E0                MOVX    A,@DPTR
0087 FC                MOV     R4,A
0088 A3                INC     DPTR
0089 E0                MOVX    A,@DPTR
008A FD                MOV     R5,A
008B EC                MOV     A,R4
008C C4                SWAP    A
008D F8                MOV     R0,A
008E 54F0              ANL     A,#0F0H
0090 C8                XCH     A,R0
0091 68                XRL     A,R0
0092 ED                MOV     A,R5
0093 C4                SWAP    A
0094 540F              ANL     A,#0FH
0096 48                ORL     A,R0
0097 904398            MOV     DPTR,#04398H
009A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 704
009B A3                INC     DPTR
009C E0                MOVX    A,@DPTR
009D 900000      R     MOV     DPTR,#cyPmBackup+08H
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 705
00A1 ED                MOV     A,R5
00A2 540F              ANL     A,#0FH
00A4 904399            MOV     DPTR,#04399H
00A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 708
00A8 A3                INC     DPTR
00A9 E0                MOVX    A,@DPTR
00AA 900000      R     MOV     DPTR,#cyPmBackup+09H
00AD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 709
00AE 900000      R     MOV     DPTR,#wakeupSource
00B1 E0                MOVX    A,@DPTR
00B2 C4                SWAP    A
00B3 5401              ANL     A,#01H
00B5 90439A            MOV     DPTR,#0439AH
00B8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 713
00B9 904393            MOV     DPTR,#04393H
00BC E0                MOVX    A,@DPTR
00BD 54F8              ANL     A,#0F8H
00BF 4401              ORL     A,#01H
00C1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 716
00C2 E0                MOVX    A,@DPTR
00C3 FF                MOV     R7,A
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 49  

                                           ; SOURCE LINE # 719
00C4 00                NOP     
                                           ; SOURCE LINE # 720
00C5 00                NOP     
                                           ; SOURCE LINE # 723
00C6 00                NOP     
                                           ; SOURCE LINE # 728
00C7 900000      R     MOV     DPTR,#cyPmBackup+07H
00CA E0                MOVX    A,@DPTR
00CB 904398            MOV     DPTR,#04398H
00CE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 729
00CF 900000      R     MOV     DPTR,#cyPmBackup+08H
00D2 E0                MOVX    A,@DPTR
00D3 904399            MOV     DPTR,#04399H
00D6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 730
00D7 900000      R     MOV     DPTR,#cyPmBackup+09H
00DA E0                MOVX    A,@DPTR
00DB 90439A            MOV     DPTR,#0439AH
00DE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 731
00DF 22                RET     
             ; FUNCTION _CyPmAltAct (END)

             ; FUNCTION _CyPmSleep (BEGIN)
                                           ; SOURCE LINE # 852
0000 900000      R     MOV     DPTR,#wakeupTime
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EC                MOV     A,R4
0007 F0                MOVX    @DPTR,A
0008 A3                INC     DPTR
0009 ED                MOV     A,R5
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 853
                                           ; SOURCE LINE # 857
000B 120000      E     LCALL   CyEnterCriticalSection
000E 900000      R     MOV     DPTR,#interruptState
0011 EF                MOV     A,R7
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 866
0013 904393            MOV     DPTR,#04393H
0016 E0                MOVX    A,@DPTR
0017 5408              ANL     A,#08H
0019 7009              JNZ     ?C0060
                                           ; SOURCE LINE # 867
                                           ; SOURCE LINE # 869
001B 904683            MOV     DPTR,#04683H
001E E0                MOVX    A,@DPTR
001F 541F              ANL     A,#01FH
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 870
0022 8009              SJMP    ?C0061
0024         ?C0060:
                                           ; SOURCE LINE # 872
                                           ; SOURCE LINE # 876
0024 900000      R     MOV     DPTR,#interruptState
0027 E0                MOVX    A,@DPTR
0028 FF                MOV     R7,A
0029 120000      E     LCALL   _CyExitCriticalSection
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 50  

002C 22                RET     
                                           ; SOURCE LINE # 879
002D         ?C0061:
                                           ; SOURCE LINE # 896
002D 9046EC            MOV     DPTR,#046ECH
0030 E0                MOVX    A,@DPTR
0031 FF                MOV     R7,A
                                           ; SOURCE LINE # 897
                                           ; SOURCE LINE # 900
0032         ?C0063:
                                           ; SOURCE LINE # 903
0032 9046F5            MOV     DPTR,#046F5H
0035 E0                MOVX    A,@DPTR
0036 5407              ANL     A,#07H
0038 6024              JZ      ?C0064
                                           ; SOURCE LINE # 905
                                           ; SOURCE LINE # 906
003A 9046EC            MOV     DPTR,#046ECH
003D E0                MOVX    A,@DPTR
003E C3                CLR     C
003F 9405              SUBB    A,#05H
0041 401B              JC      ?C0064
                                           ; SOURCE LINE # 907
                                           ; SOURCE LINE # 910
0043         ?C0065:
                                           ; SOURCE LINE # 912
                                           ; SOURCE LINE # 913
0043 904689            MOV     DPTR,#04689H
0046 E0                MOVX    A,@DPTR
0047 5401              ANL     A,#01H
0049 700D              JNZ     ?C0067
                                           ; SOURCE LINE # 914
                                           ; SOURCE LINE # 915
004B 900000      R     MOV     DPTR,#cyPmBackup+06H
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 916
004F 904689            MOV     DPTR,#04689H
0052 E0                MOVX    A,@DPTR
0053 4401              ORL     A,#01H
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 917
0056 8006              SJMP    ?C0064
0058         ?C0067:
                                           ; SOURCE LINE # 919
                                           ; SOURCE LINE # 920
0058 900000      R     MOV     DPTR,#cyPmBackup+06H
005B 7401              MOV     A,#01H
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 921
                                           ; SOURCE LINE # 922
                                           ; SOURCE LINE # 923
005E         ?C0064:
                                           ; SOURCE LINE # 948
005E 120000      R     LCALL   CyPmHibSlpSaveSet
                                           ; SOURCE LINE # 954
0061 900000      R     MOV     DPTR,#wakeupTime
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 C3                CLR     C
0067 9402              SUBB    A,#02H
0069 4016              JC      ?C0069
006B EF                MOV     A,R7
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 51  

006C D3                SETB    C
006D 940D              SUBB    A,#0DH
006F 5010              JNC     ?C0069
                                           ; SOURCE LINE # 955
                                           ; SOURCE LINE # 957
0071 EF                MOV     A,R7
0072 14                DEC     A
0073 FF                MOV     R7,A
0074 120000      R     LCALL   _CyPmCtwSetInterval
                                           ; SOURCE LINE # 960
0077 900000      R     MOV     DPTR,#wakeupSource
007A E0                MOVX    A,@DPTR
007B 4408              ORL     A,#08H
007D F0                MOVX    @DPTR,A
007E A3                INC     DPTR
007F E0                MOVX    A,@DPTR
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 961
0081         ?C0069:
                                           ; SOURCE LINE # 964
0081 900000      R     MOV     DPTR,#wakeupTime
0084 E0                MOVX    A,@DPTR
0085 B4010D            CJNE    A,#01H,?C0070
                                           ; SOURCE LINE # 965
                                           ; SOURCE LINE # 967
0088 120000      R     LCALL   CyPmOppsSet
                                           ; SOURCE LINE # 970
008B 900000      R     MOV     DPTR,#wakeupSource
008E E0                MOVX    A,@DPTR
008F 4408              ORL     A,#08H
0091 F0                MOVX    @DPTR,A
0092 A3                INC     DPTR
0093 E0                MOVX    A,@DPTR
0094 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 971
0095         ?C0070:
                                           ; SOURCE LINE # 979
0095 904398            MOV     DPTR,#04398H
0098 E0                MOVX    A,@DPTR
0099 900000      R     MOV     DPTR,#cyPmBackup+07H
009C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 980
009D 900000      R     MOV     DPTR,#wakeupSource
00A0 E0                MOVX    A,@DPTR
00A1 FC                MOV     R4,A
00A2 A3                INC     DPTR
00A3 E0                MOVX    A,@DPTR
00A4 FD                MOV     R5,A
00A5 EC                MOV     A,R4
00A6 C4                SWAP    A
00A7 F8                MOV     R0,A
00A8 54F0              ANL     A,#0F0H
00AA C8                XCH     A,R0
00AB 68                XRL     A,R0
00AC ED                MOV     A,R5
00AD C4                SWAP    A
00AE 540F              ANL     A,#0FH
00B0 48                ORL     A,R0
00B1 904398            MOV     DPTR,#04398H
00B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 983
00B5 A3                INC     DPTR
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 52  

00B6 E0                MOVX    A,@DPTR
00B7 900000      R     MOV     DPTR,#cyPmBackup+08H
00BA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 984
00BB ED                MOV     A,R5
00BC 540F              ANL     A,#0FH
00BE 904399            MOV     DPTR,#04399H
00C1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 987
00C2 A3                INC     DPTR
00C3 E0                MOVX    A,@DPTR
00C4 900000      R     MOV     DPTR,#cyPmBackup+09H
00C7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 988
00C8 900000      R     MOV     DPTR,#wakeupSource
00CB E0                MOVX    A,@DPTR
00CC C4                SWAP    A
00CD 5401              ANL     A,#01H
00CF 90439A            MOV     DPTR,#0439AH
00D2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1004
00D3 904200            MOV     DPTR,#04200H
00D6 E0                MOVX    A,@DPTR
00D7 5407              ANL     A,#07H
00D9 7007              JNZ     ?C0071
                                           ; SOURCE LINE # 1005
                                           ; SOURCE LINE # 1007
00DB 900000      R     MOV     DPTR,#cyPmBackup+030H
00DE 04                INC     A
00DF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1008
00E0 8016              SJMP    ?C0072
00E2         ?C0071:
                                           ; SOURCE LINE # 1010
                                           ; SOURCE LINE # 1012
00E2 E4                CLR     A
00E3 900000      R     MOV     DPTR,#cyPmBackup+030H
00E6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1015
00E7 904200            MOV     DPTR,#04200H
00EA E0                MOVX    A,@DPTR
00EB 5407              ANL     A,#07H
00ED 900000      R     MOV     DPTR,#cyPmBackup+02FH
00F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1018
00F1 904200            MOV     DPTR,#04200H
00F4 E0                MOVX    A,@DPTR
00F5 54F8              ANL     A,#0F8H
00F7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1019
00F8         ?C0072:
                                           ; SOURCE LINE # 1022
00F8 904393            MOV     DPTR,#04393H
00FB E0                MOVX    A,@DPTR
00FC 54F8              ANL     A,#0F8H
00FE 4403              ORL     A,#03H
0100 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1025
0101 E0                MOVX    A,@DPTR
0102 FF                MOV     R7,A
                                           ; SOURCE LINE # 1028
0103 00                NOP     
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 53  

                                           ; SOURCE LINE # 1029
0104 00                NOP     
                                           ; SOURCE LINE # 1032
0105 00                NOP     
                                           ; SOURCE LINE # 1037
0106 900000      R     MOV     DPTR,#cyPmBackup+030H
0109 E0                MOVX    A,@DPTR
010A 6401              XRL     A,#01H
010C 6010              JZ      ?C0073
                                           ; SOURCE LINE # 1038
                                           ; SOURCE LINE # 1039
010E 904200            MOV     DPTR,#04200H
0111 E0                MOVX    A,@DPTR
0112 54F8              ANL     A,#0F8H
0114 FF                MOV     R7,A
0115 900000      R     MOV     DPTR,#cyPmBackup+02FH
0118 E0                MOVX    A,@DPTR
0119 4F                ORL     A,R7
011A 904200            MOV     DPTR,#04200H
011D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1041
011E         ?C0073:
                                           ; SOURCE LINE # 1057
011E 120000      R     LCALL   CyPmHibSlpRestore
                                           ; SOURCE LINE # 1063
0121 9046F5            MOV     DPTR,#046F5H
0124 E0                MOVX    A,@DPTR
0125 5407              ANL     A,#07H
0127 6016              JZ      ?C0074
                                           ; SOURCE LINE # 1065
                                           ; SOURCE LINE # 1066
0129 9046EC            MOV     DPTR,#046ECH
012C E0                MOVX    A,@DPTR
012D C3                CLR     C
012E 9405              SUBB    A,#05H
0130 400D              JC      ?C0074
                                           ; SOURCE LINE # 1067
                                           ; SOURCE LINE # 1068
0132 900000      R     MOV     DPTR,#cyPmBackup+06H
0135 E0                MOVX    A,@DPTR
0136 7007              JNZ     ?C0074
                                           ; SOURCE LINE # 1069
                                           ; SOURCE LINE # 1070
0138 904689            MOV     DPTR,#04689H
013B E0                MOVX    A,@DPTR
013C 54FE              ANL     A,#0FEH
013E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1071
                                           ; SOURCE LINE # 1072
                                           ; SOURCE LINE # 1073
013F         ?C0074:
                                           ; SOURCE LINE # 1079
013F 900000      R     MOV     DPTR,#cyPmBackup+07H
0142 E0                MOVX    A,@DPTR
0143 904398            MOV     DPTR,#04398H
0146 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1080
0147 900000      R     MOV     DPTR,#cyPmBackup+08H
014A E0                MOVX    A,@DPTR
014B 904399            MOV     DPTR,#04399H
014E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1081
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 54  

014F 900000      R     MOV     DPTR,#cyPmBackup+09H
0152 E0                MOVX    A,@DPTR
0153 90439A            MOV     DPTR,#0439AH
0156 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1084
0157 900000      R     MOV     DPTR,#interruptState
015A E0                MOVX    A,@DPTR
015B FF                MOV     R7,A
015C 120000      E     LCALL   _CyExitCriticalSection
                                           ; SOURCE LINE # 1085
015F         ?C0062:
015F 22                RET     
             ; FUNCTION _CyPmSleep (END)

             ; FUNCTION CyPmHibernate (BEGIN)
                                           ; SOURCE LINE # 1130
                                           ; SOURCE LINE # 1131
                                           ; SOURCE LINE # 1132
0000 7F40              MOV     R7,#040H
0002 7E00              MOV     R6,#00H
0004 120000      R     LCALL   _CyPmHibernateEx
                                           ; SOURCE LINE # 1133
0007 22                RET     
             ; FUNCTION CyPmHibernate (END)

             ; FUNCTION _CyPmHibernateEx (BEGIN)
                                           ; SOURCE LINE # 1196
0000 900000      R     MOV     DPTR,#wakeupSource
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1197
                                           ; SOURCE LINE # 1201
0008 120000      E     LCALL   CyEnterCriticalSection
000B 900000      R     MOV     DPTR,#interruptState
000E EF                MOV     A,R7
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1209
0010 904393            MOV     DPTR,#04393H
0013 E0                MOVX    A,@DPTR
0014 5408              ANL     A,#08H
0016 7009              JNZ     ?C0078
                                           ; SOURCE LINE # 1210
                                           ; SOURCE LINE # 1212
0018 904683            MOV     DPTR,#04683H
001B E0                MOVX    A,@DPTR
001C 541F              ANL     A,#01FH
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1213
001F 8009              SJMP    ?C0079
0021         ?C0078:
                                           ; SOURCE LINE # 1215
                                           ; SOURCE LINE # 1219
0021 900000      R     MOV     DPTR,#interruptState
0024 E0                MOVX    A,@DPTR
0025 FF                MOV     R7,A
0026 120000      E     LCALL   _CyExitCriticalSection
0029 22                RET     
                                           ; SOURCE LINE # 1222
002A         ?C0079:
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 55  

                                           ; SOURCE LINE # 1224
002A 120000      R     LCALL   CyPmHibSaveSet
                                           ; SOURCE LINE # 1230
002D 904398            MOV     DPTR,#04398H
0030 E0                MOVX    A,@DPTR
0031 900000      R     MOV     DPTR,#cyPmBackup+07H
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1231
0035 900000      R     MOV     DPTR,#wakeupSource
0038 E0                MOVX    A,@DPTR
0039 FC                MOV     R4,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C FD                MOV     R5,A
003D EC                MOV     A,R4
003E C4                SWAP    A
003F F8                MOV     R0,A
0040 54F0              ANL     A,#0F0H
0042 C8                XCH     A,R0
0043 68                XRL     A,R0
0044 ED                MOV     A,R5
0045 C4                SWAP    A
0046 540F              ANL     A,#0FH
0048 48                ORL     A,R0
0049 5404              ANL     A,#04H
004B 904398            MOV     DPTR,#04398H
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1234
004F A3                INC     DPTR
0050 E0                MOVX    A,@DPTR
0051 900000      R     MOV     DPTR,#cyPmBackup+08H
0054 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1235
0055 ED                MOV     A,R5
0056 540F              ANL     A,#0FH
0058 904399            MOV     DPTR,#04399H
005B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1237
005C A3                INC     DPTR
005D E0                MOVX    A,@DPTR
005E 900000      R     MOV     DPTR,#cyPmBackup+09H
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1238
0062 90439A            MOV     DPTR,#0439AH
0065 E4                CLR     A
0066 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1242
0067 904200            MOV     DPTR,#04200H
006A E0                MOVX    A,@DPTR
006B 5407              ANL     A,#07H
006D 7007              JNZ     ?C0081
                                           ; SOURCE LINE # 1243
                                           ; SOURCE LINE # 1245
006F 900000      R     MOV     DPTR,#cyPmBackup+030H
0072 04                INC     A
0073 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1246
0074 8016              SJMP    ?C0082
0076         ?C0081:
                                           ; SOURCE LINE # 1248
                                           ; SOURCE LINE # 1250
0076 E4                CLR     A
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 56  

0077 900000      R     MOV     DPTR,#cyPmBackup+030H
007A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1253
007B 904200            MOV     DPTR,#04200H
007E E0                MOVX    A,@DPTR
007F 5407              ANL     A,#07H
0081 900000      R     MOV     DPTR,#cyPmBackup+02FH
0084 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1256
0085 904200            MOV     DPTR,#04200H
0088 E0                MOVX    A,@DPTR
0089 54F8              ANL     A,#0F8H
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1257
008C         ?C0082:
                                           ; SOURCE LINE # 1261
008C 904393            MOV     DPTR,#04393H
008F E0                MOVX    A,@DPTR
0090 54F8              ANL     A,#0F8H
0092 4404              ORL     A,#04H
0094 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1264
0095 E0                MOVX    A,@DPTR
0096 FF                MOV     R7,A
                                           ; SOURCE LINE # 1267
0097 00                NOP     
                                           ; SOURCE LINE # 1268
0098 00                NOP     
                                           ; SOURCE LINE # 1271
0099 00                NOP     
                                           ; SOURCE LINE # 1278
009A 900000      R     MOV     DPTR,#cyPmBackup+030H
009D E0                MOVX    A,@DPTR
009E 6401              XRL     A,#01H
00A0 6010              JZ      ?C0083
                                           ; SOURCE LINE # 1279
                                           ; SOURCE LINE # 1280
00A2 904200            MOV     DPTR,#04200H
00A5 E0                MOVX    A,@DPTR
00A6 54F8              ANL     A,#0F8H
00A8 FF                MOV     R7,A
00A9 900000      R     MOV     DPTR,#cyPmBackup+02FH
00AC E0                MOVX    A,@DPTR
00AD 4F                ORL     A,R7
00AE 904200            MOV     DPTR,#04200H
00B1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1282
00B2         ?C0083:
                                           ; SOURCE LINE # 1286
00B2 120000      R     LCALL   CyPmHibRestore
                                           ; SOURCE LINE # 1289
00B5 900000      R     MOV     DPTR,#cyPmBackup+07H
00B8 E0                MOVX    A,@DPTR
00B9 904398            MOV     DPTR,#04398H
00BC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1290
00BD 900000      R     MOV     DPTR,#cyPmBackup+08H
00C0 E0                MOVX    A,@DPTR
00C1 904399            MOV     DPTR,#04399H
00C4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1291
00C5 900000      R     MOV     DPTR,#cyPmBackup+09H
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 57  

00C8 E0                MOVX    A,@DPTR
00C9 90439A            MOV     DPTR,#0439AH
00CC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1294
00CD 900000      R     MOV     DPTR,#interruptState
00D0 E0                MOVX    A,@DPTR
00D1 FF                MOV     R7,A
00D2 120000      E     LCALL   _CyExitCriticalSection
                                           ; SOURCE LINE # 1295
00D5         ?C0080:
00D5 22                RET     
             ; FUNCTION _CyPmHibernateEx (END)

             ; FUNCTION _CyPmReadStatus (BEGIN)
                                           ; SOURCE LINE # 1327
0000 900000      R     MOV     DPTR,#mask
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1328
                                           ; SOURCE LINE # 1334
0005 120000      E     LCALL   CyEnterCriticalSection
;---- Variable 'interruptState' assigned to Register 'R5' ----
0008 AD07              MOV     R5,AR7
                                           ; SOURCE LINE # 1337
000A 900000      R     MOV     DPTR,#interruptStatus
000D E0                MOVX    A,@DPTR
000E FF                MOV     R7,A
000F 904390            MOV     DPTR,#04390H
0012 E0                MOVX    A,@DPTR
0013 FE                MOV     R6,A
0014 EF                MOV     A,R7
0015 4E                ORL     A,R6
0016 900000      R     MOV     DPTR,#interruptStatus
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1338
001A E0                MOVX    A,@DPTR
001B FC                MOV     R4,A
001C 5407              ANL     A,#07H
001E 900000      R     MOV     DPTR,#tmpStatus
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1339
0022 900000      R     MOV     DPTR,#mask
0025 E0                MOVX    A,@DPTR
0026 F4                CPL     A
0027 FF                MOV     R7,A
0028 EC                MOV     A,R4
0029 5F                ANL     A,R7
002A 900000      R     MOV     DPTR,#interruptStatus
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1342
002E AF05              MOV     R7,AR5
0030 120000      E     LCALL   _CyExitCriticalSection
                                           ; SOURCE LINE # 1344
0033 900000      R     MOV     DPTR,#tmpStatus
0036 E0                MOVX    A,@DPTR
0037 FF                MOV     R7,A
                                           ; SOURCE LINE # 1345
0038         ?C0084:
0038 22                RET     
             ; FUNCTION _CyPmReadStatus (END)

             ; FUNCTION CyPmHibSaveSet (BEGIN)
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 58  

                                           ; SOURCE LINE # 1371
                                           ; SOURCE LINE # 1372
                                           ; SOURCE LINE # 1374
0000 904331            MOV     DPTR,#04331H
0003 E0                MOVX    A,@DPTR
0004 5404              ANL     A,#04H
0006 6004              JZ      ?C0085
                                           ; SOURCE LINE # 1375
                                           ; SOURCE LINE # 1388
0008 E0                MOVX    A,@DPTR
0009 54FB              ANL     A,#0FBH
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1389
000C         ?C0085:
                                           ; SOURCE LINE # 1393
000C 7F01              MOV     R7,#01H
000E 120000      E     LCALL   _CyILO_SetPowerMode
0011 900000      R     MOV     DPTR,#cyPmBackup
0014 EF                MOV     A,R7
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1396
0016 904300            MOV     DPTR,#04300H
0019 E0                MOVX    A,@DPTR
001A 5402              ANL     A,#02H
001C 7003              JNZ     ?C0086
001E FF                MOV     R7,A
001F 8002              SJMP    ?C0087
0021         ?C0086:
0021 7F01              MOV     R7,#01H
0023         ?C0087:
0023 900000      R     MOV     DPTR,#cyPmBackup+01H
0026 EF                MOV     A,R7
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1400
0028 904300            MOV     DPTR,#04300H
002B E0                MOVX    A,@DPTR
002C 5404              ANL     A,#04H
002E 7003              JNZ     ?C0088
0030 FF                MOV     R7,A
0031 8002              SJMP    ?C0089
0033         ?C0088:
0033 7F01              MOV     R7,#01H
0035         ?C0089:
0035 900000      R     MOV     DPTR,#cyPmBackup+02H
0038 EF                MOV     A,R7
0039 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1405
003A 904683            MOV     DPTR,#04683H
003D E0                MOVX    A,@DPTR
003E 5410              ANL     A,#010H
0040 700D              JNZ     ?C0090
                                           ; SOURCE LINE # 1406
                                           ; SOURCE LINE # 1408
0042 900000      R     MOV     DPTR,#cyPmBackup+03H
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1409
0046 904683            MOV     DPTR,#04683H
0049 E0                MOVX    A,@DPTR
004A 4410              ORL     A,#010H
004C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1410
004D 8006              SJMP    ?C0091
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 59  

004F         ?C0090:
                                           ; SOURCE LINE # 1412
                                           ; SOURCE LINE # 1413
004F 900000      R     MOV     DPTR,#cyPmBackup+03H
0052 7401              MOV     A,#01H
0054 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1414
0055         ?C0091:
                                           ; SOURCE LINE # 1424
0055 120000      R     LCALL   CyPmHviLviSaveDisable
                                           ; SOURCE LINE # 1428
0058 120000      R     LCALL   CyPmHibSlpSaveSet
                                           ; SOURCE LINE # 1434
005B 904685            MOV     DPTR,#04685H
005E E0                MOVX    A,@DPTR
005F 900000      R     MOV     DPTR,#cyPmBackup+0AH
0062 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1435
0063 904686            MOV     DPTR,#04686H
0066 E0                MOVX    A,@DPTR
0067 900000      R     MOV     DPTR,#cyPmBackup+0BH
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1437
006B 904685            MOV     DPTR,#04685H
006E 74FF              MOV     A,#0FFH
0070 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1438
0071 A3                INC     DPTR
0072 7490              MOV     A,#090H
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1439
0075 22                RET     
             ; FUNCTION CyPmHibSaveSet (END)

             ; FUNCTION CyPmHibRestore (BEGIN)
                                           ; SOURCE LINE # 1461
                                           ; SOURCE LINE # 1462
                                           ; SOURCE LINE # 1464
0000 120000      R     LCALL   CyPmHviLviRestore
                                           ; SOURCE LINE # 1467
0003 120000      R     LCALL   CyPmHibSlpRestore
                                           ; SOURCE LINE # 1470
0006 900000      R     MOV     DPTR,#cyPmBackup+01H
0009 E0                MOVX    A,@DPTR
000A B40103            CJNE    A,#01H,?C0093
                                           ; SOURCE LINE # 1471
                                           ; SOURCE LINE # 1473
000D 120000      E     LCALL   CyILO_Start1K
                                           ; SOURCE LINE # 1474
0010         ?C0093:
                                           ; SOURCE LINE # 1477
0010 900000      R     MOV     DPTR,#cyPmBackup+02H
0013 E0                MOVX    A,@DPTR
0014 B40103            CJNE    A,#01H,?C0094
                                           ; SOURCE LINE # 1478
                                           ; SOURCE LINE # 1480
0017 120000      E     LCALL   CyILO_Start100K
                                           ; SOURCE LINE # 1481
001A         ?C0094:
                                           ; SOURCE LINE # 1484
001A 900000      R     MOV     DPTR,#cyPmBackup
001D E0                MOVX    A,@DPTR
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 60  

001E FF                MOV     R7,A
001F 120000      E     LCALL   _CyILO_SetPowerMode
                                           ; SOURCE LINE # 1487
0022 900000      R     MOV     DPTR,#cyPmBackup+03H
0025 E0                MOVX    A,@DPTR
0026 7007              JNZ     ?C0095
                                           ; SOURCE LINE # 1488
                                           ; SOURCE LINE # 1490
0028 904683            MOV     DPTR,#04683H
002B E0                MOVX    A,@DPTR
002C 54EF              ANL     A,#0EFH
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1491
002F         ?C0095:
                                           ; SOURCE LINE # 1497
002F 900000      R     MOV     DPTR,#cyPmBackup+0AH
0032 E0                MOVX    A,@DPTR
0033 904685            MOV     DPTR,#04685H
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1498
0037 900000      R     MOV     DPTR,#cyPmBackup+0BH
003A E0                MOVX    A,@DPTR
003B 904686            MOV     DPTR,#04686H
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1499
003F 22                RET     
             ; FUNCTION CyPmHibRestore (END)

             ; FUNCTION _CyPmCtwSetInterval (BEGIN)
                                           ; SOURCE LINE # 1522
0000 900000      R     MOV     DPTR,#ctwInterval
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1523
                                           ; SOURCE LINE # 1525
0005 904382            MOV     DPTR,#04382H
0008 E0                MOVX    A,@DPTR
0009 54F7              ANL     A,#0F7H
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1528
000C 120000      E     LCALL   CyILO_Start1K
                                           ; SOURCE LINE # 1531
000F 904382            MOV     DPTR,#04382H
0012 E0                MOVX    A,@DPTR
0013 5404              ANL     A,#04H
0015 601C              JZ      ?C0097
                                           ; SOURCE LINE # 1532
                                           ; SOURCE LINE # 1534
0017 900000      R     MOV     DPTR,#ctwInterval
001A E0                MOVX    A,@DPTR
001B FF                MOV     R7,A
001C 904381            MOV     DPTR,#04381H
001F E0                MOVX    A,@DPTR
0020 6F                XRL     A,R7
0021 6025              JZ      ?C0101
                                           ; SOURCE LINE # 1535
                                           ; SOURCE LINE # 1537
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
0025 54FB              ANL     A,#0FBH
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1538
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 61  

0028 904381            MOV     DPTR,#04381H
002B EF                MOV     A,R7
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1539
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F 4404              ORL     A,#04H
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1540
                                           ; SOURCE LINE # 1541
0032 22                RET     
0033         ?C0097:
                                           ; SOURCE LINE # 1543
                                           ; SOURCE LINE # 1545
0033 900000      R     MOV     DPTR,#ctwInterval
0036 E0                MOVX    A,@DPTR
0037 FF                MOV     R7,A
0038 904381            MOV     DPTR,#04381H
003B E0                MOVX    A,@DPTR
003C 6F                XRL     A,R7
003D 6002              JZ      ?C0100
                                           ; SOURCE LINE # 1546
                                           ; SOURCE LINE # 1548
003F EF                MOV     A,R7
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1549
0041         ?C0100:
                                           ; SOURCE LINE # 1552
0041 904382            MOV     DPTR,#04382H
0044 E0                MOVX    A,@DPTR
0045 4404              ORL     A,#04H
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1553
                                           ; SOURCE LINE # 1554
0048         ?C0101:
0048 22                RET     
             ; FUNCTION _CyPmCtwSetInterval (END)

             ; FUNCTION CyPmOppsSet (BEGIN)
                                           ; SOURCE LINE # 1574
                                           ; SOURCE LINE # 1575
                                           ; SOURCE LINE # 1577
0000 904308            MOV     DPTR,#04308H
0003 E0                MOVX    A,@DPTR
0004 5401              ANL     A,#01H
0006 7003              JNZ     ?C0102
                                           ; SOURCE LINE # 1578
                                           ; SOURCE LINE # 1580
0008 120000      E     LCALL   CyXTAL_32KHZ_Start
                                           ; SOURCE LINE # 1581
000B         ?C0102:
                                           ; SOURCE LINE # 1584
000B 904382            MOV     DPTR,#04382H
000E E0                MOVX    A,@DPTR
000F 54DF              ANL     A,#0DFH
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1587
0012 E0                MOVX    A,@DPTR
0013 4410              ORL     A,#010H
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1588
0016 22                RET     
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 62  

             ; FUNCTION CyPmOppsSet (END)

             ; FUNCTION _CyPmFtwSetInterval (BEGIN)
                                           ; SOURCE LINE # 1611
0000 900000      R     MOV     DPTR,#ftwInterval
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1612
                                           ; SOURCE LINE # 1614
0005 904382            MOV     DPTR,#04382H
0008 E0                MOVX    A,@DPTR
0009 54FD              ANL     A,#0FDH
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1617
000C 120000      E     LCALL   CyILO_Start100K
                                           ; SOURCE LINE # 1620
000F 904382            MOV     DPTR,#04382H
0012 E0                MOVX    A,@DPTR
0013 5401              ANL     A,#01H
0015 6020              JZ      ?C0104
                                           ; SOURCE LINE # 1621
                                           ; SOURCE LINE # 1623
0017 900000      R     MOV     DPTR,#ftwInterval
001A E0                MOVX    A,@DPTR
001B FF                MOV     R7,A
001C 904380            MOV     DPTR,#04380H
001F E0                MOVX    A,@DPTR
0020 6F                XRL     A,R7
0021 6029              JZ      ?C0108
                                           ; SOURCE LINE # 1624
                                           ; SOURCE LINE # 1626
0023 904382            MOV     DPTR,#04382H
0026 E0                MOVX    A,@DPTR
0027 54FE              ANL     A,#0FEH
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1627
002A 904380            MOV     DPTR,#04380H
002D EF                MOV     A,R7
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1628
002F 904382            MOV     DPTR,#04382H
0032 E0                MOVX    A,@DPTR
0033 4401              ORL     A,#01H
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1629
                                           ; SOURCE LINE # 1630
0036 22                RET     
0037         ?C0104:
                                           ; SOURCE LINE # 1632
                                           ; SOURCE LINE # 1634
0037 900000      R     MOV     DPTR,#ftwInterval
003A E0                MOVX    A,@DPTR
003B FF                MOV     R7,A
003C 904380            MOV     DPTR,#04380H
003F E0                MOVX    A,@DPTR
0040 6F                XRL     A,R7
0041 6002              JZ      ?C0107
                                           ; SOURCE LINE # 1635
                                           ; SOURCE LINE # 1637
0043 EF                MOV     A,R7
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1638
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 63  

0045         ?C0107:
                                           ; SOURCE LINE # 1641
0045 904382            MOV     DPTR,#04382H
0048 E0                MOVX    A,@DPTR
0049 4401              ORL     A,#01H
004B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1642
                                           ; SOURCE LINE # 1643
004C         ?C0108:
004C 22                RET     
             ; FUNCTION _CyPmFtwSetInterval (END)

             ; FUNCTION CyPmHibSlpSaveSet (BEGIN)
                                           ; SOURCE LINE # 1668
                                           ; SOURCE LINE # 1669
                                           ; SOURCE LINE # 1671
0000 905A00            MOV     DPTR,#05A00H
0003 E0                MOVX    A,@DPTR
0004 900000      R     MOV     DPTR,#cyPmBackup+0CH
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1672
0008 905A02            MOV     DPTR,#05A02H
000B E0                MOVX    A,@DPTR
000C 900000      R     MOV     DPTR,#cyPmBackup+0DH
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1673
0010 905A03            MOV     DPTR,#05A03H
0013 E0                MOVX    A,@DPTR
0014 900000      R     MOV     DPTR,#cyPmBackup+0EH
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1674
0018 905A04            MOV     DPTR,#05A04H
001B E0                MOVX    A,@DPTR
001C 900000      R     MOV     DPTR,#cyPmBackup+0FH
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1675
0020 905A06            MOV     DPTR,#05A06H
0023 E0                MOVX    A,@DPTR
0024 900000      R     MOV     DPTR,#cyPmBackup+010H
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1676
0028 905A08            MOV     DPTR,#05A08H
002B E0                MOVX    A,@DPTR
002C 900000      R     MOV     DPTR,#cyPmBackup+011H
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1677
0030 905A0A            MOV     DPTR,#05A0AH
0033 E0                MOVX    A,@DPTR
0034 900000      R     MOV     DPTR,#cyPmBackup+012H
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1679
0038 905A10            MOV     DPTR,#05A10H
003B E0                MOVX    A,@DPTR
003C 900000      R     MOV     DPTR,#cyPmBackup+013H
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1680
0040 905A12            MOV     DPTR,#05A12H
0043 E0                MOVX    A,@DPTR
0044 900000      R     MOV     DPTR,#cyPmBackup+014H
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1681
0048 905A13            MOV     DPTR,#05A13H
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 64  

004B E0                MOVX    A,@DPTR
004C 900000      R     MOV     DPTR,#cyPmBackup+015H
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1682
0050 905A14            MOV     DPTR,#05A14H
0053 E0                MOVX    A,@DPTR
0054 900000      R     MOV     DPTR,#cyPmBackup+016H
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1683
0058 905A16            MOV     DPTR,#05A16H
005B E0                MOVX    A,@DPTR
005C 900000      R     MOV     DPTR,#cyPmBackup+017H
005F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1684
0060 905A18            MOV     DPTR,#05A18H
0063 E0                MOVX    A,@DPTR
0064 900000      R     MOV     DPTR,#cyPmBackup+018H
0067 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1685
0068 905A1A            MOV     DPTR,#05A1AH
006B E0                MOVX    A,@DPTR
006C 900000      R     MOV     DPTR,#cyPmBackup+019H
006F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1687
0070 905A20            MOV     DPTR,#05A20H
0073 E0                MOVX    A,@DPTR
0074 900000      R     MOV     DPTR,#cyPmBackup+01AH
0077 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1688
0078 905A22            MOV     DPTR,#05A22H
007B E0                MOVX    A,@DPTR
007C 900000      R     MOV     DPTR,#cyPmBackup+01BH
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1689
0080 905A23            MOV     DPTR,#05A23H
0083 E0                MOVX    A,@DPTR
0084 900000      R     MOV     DPTR,#cyPmBackup+01CH
0087 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1690
0088 905A24            MOV     DPTR,#05A24H
008B E0                MOVX    A,@DPTR
008C 900000      R     MOV     DPTR,#cyPmBackup+01DH
008F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1691
0090 905A26            MOV     DPTR,#05A26H
0093 E0                MOVX    A,@DPTR
0094 900000      R     MOV     DPTR,#cyPmBackup+01EH
0097 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1692
0098 905A28            MOV     DPTR,#05A28H
009B E0                MOVX    A,@DPTR
009C 900000      R     MOV     DPTR,#cyPmBackup+01FH
009F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1693
00A0 905A2A            MOV     DPTR,#05A2AH
00A3 E0                MOVX    A,@DPTR
00A4 900000      R     MOV     DPTR,#cyPmBackup+020H
00A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1695
00A8 905A30            MOV     DPTR,#05A30H
00AB E0                MOVX    A,@DPTR
00AC 900000      R     MOV     DPTR,#cyPmBackup+021H
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 65  

00AF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1696
00B0 905A32            MOV     DPTR,#05A32H
00B3 E0                MOVX    A,@DPTR
00B4 900000      R     MOV     DPTR,#cyPmBackup+022H
00B7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1697
00B8 905A33            MOV     DPTR,#05A33H
00BB E0                MOVX    A,@DPTR
00BC 900000      R     MOV     DPTR,#cyPmBackup+023H
00BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1698
00C0 905A34            MOV     DPTR,#05A34H
00C3 E0                MOVX    A,@DPTR
00C4 900000      R     MOV     DPTR,#cyPmBackup+024H
00C7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1699
00C8 905A36            MOV     DPTR,#05A36H
00CB E0                MOVX    A,@DPTR
00CC 900000      R     MOV     DPTR,#cyPmBackup+025H
00CF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1700
00D0 905A38            MOV     DPTR,#05A38H
00D3 E0                MOVX    A,@DPTR
00D4 900000      R     MOV     DPTR,#cyPmBackup+026H
00D7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1701
00D8 905A3A            MOV     DPTR,#05A3AH
00DB E0                MOVX    A,@DPTR
00DC 900000      R     MOV     DPTR,#cyPmBackup+027H
00DF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1703
00E0 905A00            MOV     DPTR,#05A00H
00E3 E4                CLR     A
00E4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1704
00E5 905A02            MOV     DPTR,#05A02H
00E8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1705
00E9 A3                INC     DPTR
00EA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1706
00EB A3                INC     DPTR
00EC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1707
00ED 905A06            MOV     DPTR,#05A06H
00F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1708
00F1 905A08            MOV     DPTR,#05A08H
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1709
00F5 905A0A            MOV     DPTR,#05A0AH
00F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1711
00F9 905A10            MOV     DPTR,#05A10H
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1712
00FD 905A12            MOV     DPTR,#05A12H
0100 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1713
0101 A3                INC     DPTR
0102 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 66  

                                           ; SOURCE LINE # 1714
0103 A3                INC     DPTR
0104 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1715
0105 905A16            MOV     DPTR,#05A16H
0108 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1716
0109 905A18            MOV     DPTR,#05A18H
010C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1717
010D 905A1A            MOV     DPTR,#05A1AH
0110 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1719
0111 905A20            MOV     DPTR,#05A20H
0114 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1720
0115 905A22            MOV     DPTR,#05A22H
0118 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1721
0119 A3                INC     DPTR
011A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1722
011B A3                INC     DPTR
011C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1723
011D 905A26            MOV     DPTR,#05A26H
0120 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1724
0121 905A28            MOV     DPTR,#05A28H
0124 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1725
0125 905A2A            MOV     DPTR,#05A2AH
0128 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1727
0129 905A30            MOV     DPTR,#05A30H
012C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1728
012D 905A32            MOV     DPTR,#05A32H
0130 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1729
0131 A3                INC     DPTR
0132 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1730
0133 A3                INC     DPTR
0134 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1731
0135 905A36            MOV     DPTR,#05A36H
0138 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1732
0139 905A38            MOV     DPTR,#05A38H
013C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1733
013D 905A3A            MOV     DPTR,#05A3AH
0140 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1741
0141 9046E8            MOV     DPTR,#046E8H
0144 E0                MOVX    A,@DPTR
0145 5404              ANL     A,#04H
0147 6022              JZ      ?C0109
                                           ; SOURCE LINE # 1742
                                           ; SOURCE LINE # 1744
0149 900000      R     MOV     DPTR,#cyPmBackup+04H
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 67  

014C 7401              MOV     A,#01H
014E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1747
014F 90500B            MOV     DPTR,#0500BH
0152 E0                MOVX    A,@DPTR
0153 540E              ANL     A,#0EH
0155 900000      R     MOV     DPTR,#cyPmBackup+05H
0158 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1750
0159 90500B            MOV     DPTR,#0500BH
015C E0                MOVX    A,@DPTR
015D 54F1              ANL     A,#0F1H
015F 440C              ORL     A,#0CH
0161 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1754
0162 9046E8            MOV     DPTR,#046E8H
0165 E0                MOVX    A,@DPTR
0166 54FB              ANL     A,#0FBH
0168 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1755
0169 8005              SJMP    ?C0110
016B         ?C0109:
                                           ; SOURCE LINE # 1757
                                           ; SOURCE LINE # 1759
016B E4                CLR     A
016C 900000      R     MOV     DPTR,#cyPmBackup+04H
016F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1760
0170         ?C0110:
                                           ; SOURCE LINE # 1769
0170 904322            MOV     DPTR,#04322H
0173 E0                MOVX    A,@DPTR
0174 5408              ANL     A,#08H
0176 600E              JZ      ?C0111
                                           ; SOURCE LINE # 1770
                                           ; SOURCE LINE # 1771
0178 900000      R     MOV     DPTR,#cyPmBackup+031H
017B 7401              MOV     A,#01H
017D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1772
017E 904322            MOV     DPTR,#04322H
0181 E0                MOVX    A,@DPTR
0182 54F7              ANL     A,#0F7H
0184 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1773
0185 22                RET     
0186         ?C0111:
                                           ; SOURCE LINE # 1775
                                           ; SOURCE LINE # 1776
0186 E4                CLR     A
0187 900000      R     MOV     DPTR,#cyPmBackup+031H
018A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1777
                                           ; SOURCE LINE # 1778
018B         ?C0113:
018B 22                RET     
             ; FUNCTION CyPmHibSlpSaveSet (END)

             ; FUNCTION CyPmHibSlpRestore (BEGIN)
                                           ; SOURCE LINE # 1799
                                           ; SOURCE LINE # 1800
                                           ; SOURCE LINE # 1802
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 68  

0000 900000      R     MOV     DPTR,#cyPmBackup+0CH
0003 E0                MOVX    A,@DPTR
0004 905A00            MOV     DPTR,#05A00H
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1803
0008 900000      R     MOV     DPTR,#cyPmBackup+0DH
000B E0                MOVX    A,@DPTR
000C 905A02            MOV     DPTR,#05A02H
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1804
0010 900000      R     MOV     DPTR,#cyPmBackup+0EH
0013 E0                MOVX    A,@DPTR
0014 905A03            MOV     DPTR,#05A03H
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1805
0018 900000      R     MOV     DPTR,#cyPmBackup+0FH
001B E0                MOVX    A,@DPTR
001C 905A04            MOV     DPTR,#05A04H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1806
0020 900000      R     MOV     DPTR,#cyPmBackup+010H
0023 E0                MOVX    A,@DPTR
0024 905A06            MOV     DPTR,#05A06H
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1807
0028 900000      R     MOV     DPTR,#cyPmBackup+011H
002B E0                MOVX    A,@DPTR
002C 905A08            MOV     DPTR,#05A08H
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1808
0030 900000      R     MOV     DPTR,#cyPmBackup+012H
0033 E0                MOVX    A,@DPTR
0034 905A0A            MOV     DPTR,#05A0AH
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1810
0038 900000      R     MOV     DPTR,#cyPmBackup+013H
003B E0                MOVX    A,@DPTR
003C 905A10            MOV     DPTR,#05A10H
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1811
0040 900000      R     MOV     DPTR,#cyPmBackup+014H
0043 E0                MOVX    A,@DPTR
0044 905A12            MOV     DPTR,#05A12H
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1812
0048 900000      R     MOV     DPTR,#cyPmBackup+015H
004B E0                MOVX    A,@DPTR
004C 905A13            MOV     DPTR,#05A13H
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1813
0050 900000      R     MOV     DPTR,#cyPmBackup+016H
0053 E0                MOVX    A,@DPTR
0054 905A14            MOV     DPTR,#05A14H
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1814
0058 900000      R     MOV     DPTR,#cyPmBackup+017H
005B E0                MOVX    A,@DPTR
005C 905A16            MOV     DPTR,#05A16H
005F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1815
0060 900000      R     MOV     DPTR,#cyPmBackup+018H
0063 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 69  

0064 905A18            MOV     DPTR,#05A18H
0067 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1816
0068 900000      R     MOV     DPTR,#cyPmBackup+019H
006B E0                MOVX    A,@DPTR
006C 905A1A            MOV     DPTR,#05A1AH
006F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1818
0070 900000      R     MOV     DPTR,#cyPmBackup+01AH
0073 E0                MOVX    A,@DPTR
0074 905A20            MOV     DPTR,#05A20H
0077 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1819
0078 900000      R     MOV     DPTR,#cyPmBackup+01BH
007B E0                MOVX    A,@DPTR
007C 905A22            MOV     DPTR,#05A22H
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1820
0080 900000      R     MOV     DPTR,#cyPmBackup+01CH
0083 E0                MOVX    A,@DPTR
0084 905A23            MOV     DPTR,#05A23H
0087 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1821
0088 900000      R     MOV     DPTR,#cyPmBackup+01DH
008B E0                MOVX    A,@DPTR
008C 905A24            MOV     DPTR,#05A24H
008F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1822
0090 900000      R     MOV     DPTR,#cyPmBackup+01EH
0093 E0                MOVX    A,@DPTR
0094 905A26            MOV     DPTR,#05A26H
0097 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1823
0098 900000      R     MOV     DPTR,#cyPmBackup+01FH
009B E0                MOVX    A,@DPTR
009C 905A28            MOV     DPTR,#05A28H
009F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1824
00A0 900000      R     MOV     DPTR,#cyPmBackup+020H
00A3 E0                MOVX    A,@DPTR
00A4 905A2A            MOV     DPTR,#05A2AH
00A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1826
00A8 900000      R     MOV     DPTR,#cyPmBackup+021H
00AB E0                MOVX    A,@DPTR
00AC 905A30            MOV     DPTR,#05A30H
00AF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1827
00B0 900000      R     MOV     DPTR,#cyPmBackup+022H
00B3 E0                MOVX    A,@DPTR
00B4 905A32            MOV     DPTR,#05A32H
00B7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1828
00B8 900000      R     MOV     DPTR,#cyPmBackup+023H
00BB E0                MOVX    A,@DPTR
00BC 905A33            MOV     DPTR,#05A33H
00BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1829
00C0 900000      R     MOV     DPTR,#cyPmBackup+024H
00C3 E0                MOVX    A,@DPTR
00C4 905A34            MOV     DPTR,#05A34H
00C7 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 70  

                                           ; SOURCE LINE # 1830
00C8 900000      R     MOV     DPTR,#cyPmBackup+025H
00CB E0                MOVX    A,@DPTR
00CC 905A36            MOV     DPTR,#05A36H
00CF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1831
00D0 900000      R     MOV     DPTR,#cyPmBackup+026H
00D3 E0                MOVX    A,@DPTR
00D4 905A38            MOV     DPTR,#05A38H
00D7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1832
00D8 900000      R     MOV     DPTR,#cyPmBackup+027H
00DB E0                MOVX    A,@DPTR
00DC 905A3A            MOV     DPTR,#05A3AH
00DF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1838
00E0 900000      R     MOV     DPTR,#cyPmBackup+04H
00E3 E0                MOVX    A,@DPTR
00E4 B40117            CJNE    A,#01H,?C0114
                                           ; SOURCE LINE # 1839
                                           ; SOURCE LINE # 1841
00E7 90500B            MOV     DPTR,#0500BH
00EA E0                MOVX    A,@DPTR
00EB 54F1              ANL     A,#0F1H
00ED FF                MOV     R7,A
00EE 900000      R     MOV     DPTR,#cyPmBackup+05H
00F1 E0                MOVX    A,@DPTR
00F2 4F                ORL     A,R7
00F3 90500B            MOV     DPTR,#0500BH
00F6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1845
00F7 9046E8            MOV     DPTR,#046E8H
00FA E0                MOVX    A,@DPTR
00FB 4404              ORL     A,#04H
00FD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1846
00FE         ?C0114:
                                           ; SOURCE LINE # 1852
00FE 900000      R     MOV     DPTR,#cyPmBackup+031H
0101 E0                MOVX    A,@DPTR
0102 B40107            CJNE    A,#01H,?C0116
                                           ; SOURCE LINE # 1853
                                           ; SOURCE LINE # 1854
0105 904322            MOV     DPTR,#04322H
0108 E0                MOVX    A,@DPTR
0109 4408              ORL     A,#08H
010B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1855
                                           ; SOURCE LINE # 1856
010C         ?C0116:
010C 22                RET     
             ; FUNCTION CyPmHibSlpRestore (END)

             ; FUNCTION CyPmHviLviSaveDisable (BEGIN)
                                           ; SOURCE LINE # 1876
                                           ; SOURCE LINE # 1877
                                           ; SOURCE LINE # 1878
0000 9046F5            MOV     DPTR,#046F5H
0003 E0                MOVX    A,@DPTR
0004 5401              ANL     A,#01H
0006 6027              JZ      ?C0117
                                           ; SOURCE LINE # 1879
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 71  

                                           ; SOURCE LINE # 1880
0008 900000      R     MOV     DPTR,#cyPmBackup+028H
000B 7401              MOV     A,#01H
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1881
000E 9046F4            MOV     DPTR,#046F4H
0011 E0                MOVX    A,@DPTR
0012 540F              ANL     A,#0FH
0014 900000      R     MOV     DPTR,#cyPmBackup+029H
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1884
0018 9046F7            MOV     DPTR,#046F7H
001B E0                MOVX    A,@DPTR
001C 5440              ANL     A,#040H
001E 7003              JNZ     ?C0118
0020 FF                MOV     R7,A
0021 8002              SJMP    ?C0119
0023         ?C0118:
0023 7F01              MOV     R7,#01H
0025         ?C0119:
0025 900000      R     MOV     DPTR,#cyPmBackup+02DH
0028 EF                MOV     A,R7
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1887
002A 120000      E     LCALL   CyVdLvDigitDisable
                                           ; SOURCE LINE # 1888
002D 8005              SJMP    ?C0120
002F         ?C0117:
                                           ; SOURCE LINE # 1890
                                           ; SOURCE LINE # 1891
002F E4                CLR     A
0030 900000      R     MOV     DPTR,#cyPmBackup+028H
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1892
0034         ?C0120:
                                           ; SOURCE LINE # 1894
0034 9046F5            MOV     DPTR,#046F5H
0037 E0                MOVX    A,@DPTR
0038 5402              ANL     A,#02H
003A 6029              JZ      ?C0121
                                           ; SOURCE LINE # 1895
                                           ; SOURCE LINE # 1896
003C 900000      R     MOV     DPTR,#cyPmBackup+02AH
003F 7401              MOV     A,#01H
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1897
0042 9046F4            MOV     DPTR,#046F4H
0045 E0                MOVX    A,@DPTR
0046 FF                MOV     R7,A
0047 C4                SWAP    A
0048 540F              ANL     A,#0FH
004A 900000      R     MOV     DPTR,#cyPmBackup+02BH
004D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1900
004E 9046F7            MOV     DPTR,#046F7H
0051 E0                MOVX    A,@DPTR
0052 5480              ANL     A,#080H
0054 7003              JNZ     ?C0122
0056 FF                MOV     R7,A
0057 8002              SJMP    ?C0123
0059         ?C0122:
0059 7F01              MOV     R7,#01H
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 72  

005B         ?C0123:
005B 900000      R     MOV     DPTR,#cyPmBackup+02EH
005E EF                MOV     A,R7
005F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1903
0060 120000      E     LCALL   CyVdLvAnalogDisable
                                           ; SOURCE LINE # 1904
0063 8005              SJMP    ?C0124
0065         ?C0121:
                                           ; SOURCE LINE # 1906
                                           ; SOURCE LINE # 1907
0065 E4                CLR     A
0066 900000      R     MOV     DPTR,#cyPmBackup+02AH
0069 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1908
006A         ?C0124:
                                           ; SOURCE LINE # 1910
006A 9046F5            MOV     DPTR,#046F5H
006D E0                MOVX    A,@DPTR
006E 5404              ANL     A,#04H
0070 600A              JZ      ?C0125
                                           ; SOURCE LINE # 1911
                                           ; SOURCE LINE # 1912
0072 900000      R     MOV     DPTR,#cyPmBackup+02CH
0075 7401              MOV     A,#01H
0077 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1913
0078 120000      E     LCALL   CyVdHvAnalogDisable
                                           ; SOURCE LINE # 1914
007B 22                RET     
007C         ?C0125:
                                           ; SOURCE LINE # 1916
                                           ; SOURCE LINE # 1917
007C E4                CLR     A
007D 900000      R     MOV     DPTR,#cyPmBackup+02CH
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1918
                                           ; SOURCE LINE # 1919
0081         ?C0127:
0081 22                RET     
             ; FUNCTION CyPmHviLviSaveDisable (END)

             ; FUNCTION CyPmHviLviRestore (BEGIN)
                                           ; SOURCE LINE # 1939
                                           ; SOURCE LINE # 1940
                                           ; SOURCE LINE # 1942
0000 900000      R     MOV     DPTR,#cyPmBackup+028H
0003 E0                MOVX    A,@DPTR
0004 B4010D            CJNE    A,#01H,?C0128
                                           ; SOURCE LINE # 1943
                                           ; SOURCE LINE # 1944
0007 900000      R     MOV     DPTR,#cyPmBackup+02DH
000A E0                MOVX    A,@DPTR
000B FF                MOV     R7,A
000C 900000      R     MOV     DPTR,#cyPmBackup+029H
000F E0                MOVX    A,@DPTR
0010 FD                MOV     R5,A
0011 120000      E     LCALL   _CyVdLvDigitEnable
                                           ; SOURCE LINE # 1945
0014         ?C0128:
                                           ; SOURCE LINE # 1947
0014 900000      R     MOV     DPTR,#cyPmBackup+02AH
C51 COMPILER V9.51   CYPM                                                                  02/14/2017 15:10:02 PAGE 73  

0017 E0                MOVX    A,@DPTR
0018 B4010D            CJNE    A,#01H,?C0129
                                           ; SOURCE LINE # 1948
                                           ; SOURCE LINE # 1949
001B 900000      R     MOV     DPTR,#cyPmBackup+02EH
001E E0                MOVX    A,@DPTR
001F FF                MOV     R7,A
0020 900000      R     MOV     DPTR,#cyPmBackup+02BH
0023 E0                MOVX    A,@DPTR
0024 FD                MOV     R5,A
0025 120000      E     LCALL   _CyVdLvAnalogEnable
                                           ; SOURCE LINE # 1950
0028         ?C0129:
                                           ; SOURCE LINE # 1952
0028 900000      R     MOV     DPTR,#cyPmBackup+02CH
002B E0                MOVX    A,@DPTR
002C B40103            CJNE    A,#01H,?C0131
                                           ; SOURCE LINE # 1953
                                           ; SOURCE LINE # 1954
002F 120000      E     LCALL   CyVdHvAnalogEnable
                                           ; SOURCE LINE # 1955
                                           ; SOURCE LINE # 1956
0032         ?C0131:
0032 22                RET     
             ; FUNCTION CyPmHviLviRestore (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3069    ----
   CONSTANT SIZE    =     14    ----
   XDATA SIZE       =     67      18
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
